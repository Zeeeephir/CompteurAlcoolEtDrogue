<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compteur de Jägerbombs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            display: flex;
            flex-direction: column; /* Permet aux éléments de s'empiler verticalement */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #18181b; /* Zinc-900 pour un fond sombre */
            color: #d4d4d8; /* Zinc-300 pour le texte clair */
            overflow-x: hidden; /* Empêche le défilement horizontal */
            padding: 1rem; /* Ajoute un padding global pour ne pas coller les bords */
        }

        /* Styles pour les particules d'emoji/confettis */
        .confetti-emoji {
            position: absolute;
            font-size: 2rem; /* Taille des emojis */
            opacity: 0;
            animation: confetti-burst 2s forwards ease-out; /* Durée de l'animation */
            pointer-events: none; /* Permet de cliquer à travers les emojis */
        }

        @keyframes confetti-burst {
            0% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(var(--x), var(--y)) rotate(var(--rotate));
            }
        }

        /* Animation pour l'overlay de célébration ultime */
        @keyframes pulse-bg {
            0% { background-color: #dc2626; } /* Red-600 */
            50% { background-color: #ea580c; } /* Orange-600 */
            100% { background-color: #dc2626; }
        }

        .ultimate-celebration-active {
            animation: pulse-bg 1s infinite alternate;
        }

        /* Styles pour les onglets */
        .tab-button {
            /* flex-grow: 1; <-- Supprimé pour permettre le défilement horizontal */
            text-align: center; /* Centrer le texte pour les onglets horizontaux */
            border-bottom: 2px solid transparent; /* Bordure par défaut pour le bas (mobile) */
            color: #d4d4d8; /* Couleur de texte par défaut */
            padding: 0.75rem 1rem; /* Padding ajusté */
            white-space: nowrap; /* Empêche le texte de se casser sur plusieurs lignes */
        }

        .tab-button.active {
            background-color: #27272a; /* Zinc-800 */
            border-bottom: 2px solid #16a34a; /* Green-600 pour l'onglet actif (mobile) */
            color: #16a34a; /* Green-600 */
        }

        /* Styles spécifiques pour les onglets sur les grands écrans (lg) */
        @media (min-width: 1024px) {
            .tab-button {
                border-right: 2px solid transparent; /* Bordure par défaut pour la droite (desktop) */
                border-bottom: none; /* Supprime la bordure du bas */
                text-align: left; /* Alignement du texte à gauche sur desktop */
                padding: 0.5rem 1rem; /* Padding ajusté pour desktop */
                flex-grow: 0; /* Ne pas étirer les boutons sur desktop */
            }
            .tab-button.active {
                border-right: 2px solid #16a34a; /* Green-600 pour l'onglet actif (desktop) */
                border-bottom: none; /* Supprime la bordure du bas */
            }
        }

        /* Animation subtile pour le texte des paliers */
        @keyframes milestone-flash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        .milestone-text-active {
            animation: milestone-flash 1s ease-out;
        }

        /* Styles pour l'écran Action ou Vérité */
        #actionOrTruthScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); /* Fond sombre semi-transparent */
            display: none; /* Assurez-vous qu'il est masqué par défaut via CSS */
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Assure qu'il est au-dessus de tout */
            backdrop-filter: blur(5px); /* Effet de flou sur l'arrière-plan */
            padding: 1rem; /* Ajout de padding pour éviter que le contenu ne touche les bords */
        }

        #actionOrTruthContent {
            background-color: #27272a; /* Zinc-800 */
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            max-width: 90%; /* Limite la largeur sur mobile */
            width: 500px; /* Largeur max sur desktop */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            transform: scale(0.8);
            opacity: 0;
            animation: popIn 0.3s forwards ease-out;
        }

        @keyframes popIn {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="p-4">
    <div class="flex flex-col items-center justify-center min-h-screen w-full">

        <div id="welcomeScreen" class="bg-zinc-800 p-8 rounded-xl shadow-2xl text-center max-w-sm w-full border border-zinc-700 mx-auto">
            <h1 class="text-4xl sm:text-5xl font-extrabold mb-8 text-green-600">
                Bienvenue à la soirée Jägerbombs de l'AFEM&Co !
            </h1>
            <p class="text-base sm:text-lg mb-8 text-zinc-300">
                Préparez-vous à compter vos Jägerbombs et à estimer votre alcoolémie.
            </p>
            <button id="startButton"
                    class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50">
                Commencer à faire la fête !
            </button>
        </div>

        <div id="objectiveSettingScreen" class="bg-zinc-800 p-8 rounded-xl shadow-2xl text-center max-w-sm w-full border border-zinc-700 mx-auto hidden">
            <h1 class="text-3xl sm:text-4xl font-extrabold mb-6 text-green-600">
                Fixez votre objectif de la soirée
            </h1>
            <label for="initialObjectiveInput" class="text-base sm:text-lg mb-2 block">Combien de Jägerbombs visez-vous ?</label>
            <input type="number" id="initialObjectiveInput" value="50" min="1"
                   class="bg-zinc-700 text-white rounded-md p-2 w-24 sm:w-32 text-center mb-2 focus:outline-none focus:ring-2 focus:ring-green-600">
            <p id="objectiveError" class="text-red-400 text-sm mb-4 hidden">Veuillez entrer un objectif valide (nombre positif).</p>
            <button id="setObjectiveButton"
                    class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-50">
                Valider l'objectif
            </button>
        </div>

        <div id="mainAppScreen" class="flex flex-col items-center lg:flex-row lg:items-start justify-center gap-4 sm:gap-8 p-4 w-full max-w-6xl mx-auto hidden">
            <div class="bg-zinc-800 p-4 sm:p-8 rounded-xl shadow-2xl w-full border border-zinc-700 relative overflow-hidden flex flex-col">
                <div class="flex flex-row justify-around border-b border-zinc-700 lg:flex-col lg:border-b-0 lg:border-r lg:pr-4 lg:mr-4 lg:w-1/4 pb-2 lg:pb-0 w-full overflow-x-auto flex-nowrap">
                    <h1 class="hidden lg:block text-2xl font-extrabold mb-6 text-green-600 text-left">
                        Nombre personnel de Jägerbombs
                    </h1>
                    <button id="tabCounter" class="tab-button text-sm sm:text-md font-semibold transition-colors duration-200 active">
                        Compteur
                    </button>
                    <button id="tabObjective" class="tab-button text-sm sm:text-md font-semibold transition-colors duration-200">
                        Objectif & Jauge
                    </button>
                    <button id="tabBAC" class="tab-button text-sm sm:text-md font-semibold transition-colors duration-200">
                        Alcoolémie
                    </button>
                    <button id="tabGame" class="tab-button text-sm sm:text-md font-semibold transition-colors duration-200">
                        Jeu
                    </button>
                    <button id="tabSettings" class="tab-button text-sm sm:text-md font-semibold transition-colors duration-200">
                        Paramètres
                    </button>
                </div>

                <div id="tabContent" class="flex-grow text-center mt-4 lg:mt-0 p-4 sm:p-0">
                    <div id="contentCounter" class="tab-pane">
                        <p id="recordToBeat" class="text-xs sm:text-sm text-zinc-400 text-left mb-4">
                            Record à battre : 2500 Jägerbombs au total !
                        </p>
                        <p class="text-base sm:text-lg mb-4 text-zinc-300">
                            Nombre de Jägerbombs bu(s) :
                        </p>
                        <div id="countDisplay" class="text-6xl sm:text-7xl font-bold mb-4 text-orange-400">
                            0
                        </div>

                        <div id="nextMilestoneDisplay" class="text-base sm:text-xl font-semibold mb-8 text-zinc-400">
                            Prochain palier : -- Jägerbombs
                        </div>

                        <button id="incrementButton"
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 sm:py-4 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50">
                            + 1 Jägerbomb
                        </button>

                        <div class="grid grid-cols-2 gap-3 sm:gap-4 mt-6">
                            <button id="increment5Button"
                                    class="bg-green-700 hover:bg-green-800 text-white font-bold py-2 sm:py-3 px-4 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-600 focus:ring-opacity-50">
                                + 5
                            </button>
                            <button id="increment10Button"
                                    class="bg-orange-700 hover:bg-orange-800 text-white font-bold py-2 sm:py-3 px-4 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-orange-600 focus:ring-opacity-50">
                                + 10
                            </button>
                            <button id="increment20Button"
                                    class="col-span-2 bg-red-700 hover:bg-red-800 text-white font-bold py-2 sm:py-3 px-4 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-600 focus:ring-opacity-50">
                                + 20
                            </button>
                        </div>

                        <button id="resetButton"
                                class="w-full mt-6 bg-zinc-600 hover:bg-zinc-700 text-white font-bold py-2 sm:py-3 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-zinc-500 focus:ring-opacity-50">
                            Remise à zero
                        </button>
                    </div>

                    <div id="contentObjective" class="tab-pane hidden">
                        <label for="objectiveInput" class="text-base sm:text-lg mb-2 block">Objectif Jägerbombs :</label>
                        <input type="number" id="objectiveInput" value="50" min="1"
                               class="bg-zinc-700 text-white rounded-md p-2 w-24 sm:w-32 text-center mb-6 focus:outline-none focus:ring-2 focus:ring-green-600">

                        <div class="flex flex-col items-center">
                            <p class="text-base sm:text-lg mb-2 text-zinc-300">Progression :</p>
                            <div class="relative w-20 h-48 sm:w-24 sm:h-64 bg-zinc-700 rounded-b-3xl rounded-t-lg overflow-hidden border-2 border-zinc-600">
                                <div class="absolute -top-4 left-1/2 -translate-x-1/2 w-10 h-6 sm:w-12 sm:h-8 bg-zinc-700 rounded-t-lg border-x-2 border-t-2 border-zinc-600"></div>
                                <div class="absolute -top-8 left-1/2 -translate-x-1/2 w-6 h-6 sm:w-8 sm:h-8 bg-zinc-700 rounded-t-lg border-x-2 border-t-2 border-zinc-600"></div>

                                <div id="liquidLevel" class="absolute bottom-0 left-0 w-full bg-green-600 transition-all duration-500 ease-out" style="height: 0%;"></div>

                                <div id="milestone1" class="absolute left-0 w-full h-0.5 bg-orange-400 opacity-75" style="bottom: 0%;"></div>
                                <div id="milestone2" class="absolute left-0 w-full h-0.5 bg-red-400 opacity-75" style="bottom: 0%;"></div>
                                <div id="milestone3" class="absolute left-0 w-full h-0.5 bg-yellow-400 opacity-75" style="bottom: 0%;"></div>

                                <span id="milestone1Text" class="absolute left-full ml-2 text-xs sm:text-sm text-orange-400 font-bold" style="bottom: 0%; display: block;"></span>
                                <span id="milestone2Text" class="absolute left-full ml-2 text-xs sm:text-sm text-red-400 font-bold" style="bottom: 0%; display: block;"></span>
                                <span id="milestone3Text" class="absolute left-full ml-2 text-xs sm:text-sm text-yellow-400 font-bold" style="bottom: 0%; display: block;"></span>
                            </div>
                        </div>
                    </div>

                    <div id="contentBAC" class="tab-pane hidden">
                        <h2 class="text-2xl sm:text-3xl font-extrabold mb-6 text-green-600">
                            Alcoolémie Estimée
                        </h2>
                        <label for="weightInput" class="text-base sm:text-lg mb-2 block">Votre poids (kg) :</label>
                        <input type="number" id="weightInput" value="70" min="1"
                               class="bg-zinc-700 text-white rounded-md p-2 w-24 sm:w-32 text-center mb-6 focus:outline-none focus:ring-2 focus:ring-green-600">

                        <div class="flex items-center justify-center mb-4">
                            <input type="checkbox" id="youngDriverCheckbox" class="form-checkbox h-5 w-5 text-green-600 rounded mr-2">
                            <label for="youngDriverCheckbox" class="text-base sm:text-lg text-zinc-300">Jeune permis (< 3 ans)</label>
                        </div>

                        <p class="text-base sm:text-lg mb-2 text-zinc-300">
                            Alcoolémie (g/L) :
                        </p>
                        <div id="bacDisplay" class="text-4xl sm:text-5xl font-bold mb-6 text-yellow-400">
                            0.00
                        </div>

                        <p class="text-base sm:text-lg mb-2 text-zinc-300">
                            Statut de conduite :
                        </p>
                        <div id="drivingStatusDisplay" class="text-2xl sm:text-3xl font-bold">
                            </div>

                        <p class="text-base sm:text-lg mb-2 text-zinc-300">
                            Temps de décuvage estimé :
                        </p>
                        <div id="soberUpTimeDisplay" class="text-2xl sm:text-3xl font-bold text-blue-400">
                            0h 00m
                        </div>
                        <p class="text-xs sm:text-sm mt-2 text-zinc-400">
                            (Basé sur un homme moyen et une élimination de 0.10 à 0.15 g/L par heure)
                        </p>
                        <p class="text-xs sm:text-sm mt-2 text-zinc-400">
                            Heure estimée pour conduire :
                        </p>
                        <div id="driveTimeDisplay" class="text-xl sm:text-2xl font-bold text-green-400">
                            --:--
                        </div>
                    </div>

                    <div id="contentGame" class="tab-pane hidden">
                        <h2 class="text-2xl sm:text-3xl font-extrabold mb-6 text-green-600">
                            Attrape le Jägerbomb !
                        </h2>
                        <p class="text-base sm:text-lg mb-4 text-zinc-300">
                            Score : <span id="gameScoreDisplay" class="font-bold text-orange-400">0</span>
                        </p>
                        <p class="text-base sm:text-lg mb-6 text-zinc-300">
                            Temps restant : <span id="gameTimerDisplay" class="font-bold text-yellow-400">30s</span>
                        </p>
                        <button id="startGameButton"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 sm:py-4 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                            Commencer le jeu
                        </button>
                        <div id="gameArea" class="relative w-full h-64 sm:h-80 bg-zinc-700 rounded-lg mt-6 overflow-hidden border-2 border-zinc-600">
                            </div>
                        <div id="gameResultDisplay" class="hidden mt-4 p-4 bg-zinc-700 rounded-lg">
                            <p class="text-xl sm:text-2xl font-bold text-green-400 mb-2">Partie terminée !</p>
                            <p class="text-lg sm:text-xl text-zinc-300">Votre score : <span id="finalGameScore" class="font-bold text-orange-400">0</span></p>
                            <p class="text-lg sm:text-xl text-zinc-300">Meilleur score : <span id="highGameScore" class="font-bold text-yellow-400">0</span></p>
                            <button id="playAgainButton"
                                    class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                                Rejouer
                            </button>
                        </div>
                    </div>

                    <div id="contentSettings" class="tab-pane hidden">
                        <h2 class="text-2xl sm:text-3xl font-extrabold mb-6 text-green-600">
                            Paramètres
                        </h2>
                        <div class="flex items-center mb-4 justify-center">
                            <input type="checkbox" id="actionOrTruthToggle" class="form-checkbox h-5 w-5 text-green-600 rounded mr-2">
                            <label for="actionOrTruthToggle" class="text-base sm:text-lg text-zinc-300">Afficher "Action ou Vérité" aux paliers</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="actionOrTruthScreen" style="display: none;">
        <div id="actionOrTruthContent" class="bg-zinc-800 p-6 sm:p-8 rounded-xl shadow-2xl text-center">
            <h2 class="text-3xl sm:text-4xl font-extrabold mb-6 text-green-600">Action ou Vérité ?</h2>
            <p id="challengeDisplay" class="text-xl sm:text-2xl mb-8 text-zinc-300 min-h-[4rem] flex items-center justify-center">
                Choisis ton destin !
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4 mb-6">
                <button id="actionButton"
                        class="w-full sm:w-auto bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50">
                    Action
                </button>
                <button id="truthButton"
                        class="w-full sm:w-auto bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-50">
                    Vérité
                </button>
            </div>
            <button id="doneButton"
                    class="w-full bg-zinc-600 hover:bg-zinc-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-zinc-500 focus:ring-opacity-50">
                FAIT !
            </button>
        </div>
    </div>

    <div id="fireworksContainer" class="fixed inset-0 pointer-events-none z-20"></div>

    <div id="ultimateCelebrationOverlay" class="fixed inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-red-800 to-yellow-600 z-30 hidden opacity-0 transition-opacity duration-500 ease-out">
        <h2 class="text-5xl sm:text-7xl font-extrabold mb-8 animate-pulse">OBJECTIF ATTEINT !</h2>
        <p class="text-3xl sm:text-4xl font-bold" id="ultimateCelebrationCount">0 Jägerbombs !</p>
    </div>

    <footer class="mt-8 mb-4 text-zinc-400 text-sm flex flex-col items-center justify-center gap-2">
        <p>fait par NoisyNeighbors</p>
        <a href="https://www.instagram.com/noisyneighborsmusic?igsh=MW5rZzJ4ajBpdDVvMA%3D%3D&utm_source=qr" target="_blank" rel="noopener noreferrer" class="hover:opacity-80 transition-opacity">
            <img src="https://placehold.co/32x32/18181b/d4d4d8?text=IG" alt="Logo Instagram" class="w-8 h-8 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/32x32/18181b/d4d4d8?text=IG'">
        </a>
    </footer>

    <script>
        // Références aux éléments du DOM
        const welcomeScreen = document.getElementById('welcomeScreen');
        const startButton = document.getElementById('startButton');
        const objectiveSettingScreen = document.getElementById('objectiveSettingScreen');
        const initialObjectiveInput = document.getElementById('initialObjectiveInput');
        const setObjectiveButton = document.getElementById('setObjectiveButton');
        const objectiveError = document.getElementById('objectiveError');
        const mainAppScreen = document.getElementById('mainAppScreen');

        const countDisplay = document.getElementById('countDisplay');
        const nextMilestoneDisplay = document.getElementById('nextMilestoneDisplay');
        const incrementButton = document.getElementById('incrementButton');
        const increment5Button = document.getElementById('increment5Button');
        const increment10Button = document.getElementById('increment10Button');
        const increment20Button = document.getElementById('increment20Button');
        const resetButton = document.getElementById('resetButton');
        const objectiveInput = document.getElementById('objectiveInput');
        const liquidLevel = document.getElementById('liquidLevel');
        const fireworksContainer = document.getElementById('fireworksContainer');
        const ultimateCelebrationOverlay = document.getElementById('ultimateCelebrationOverlay');
        const ultimateCelebrationCount = document.getElementById('ultimateCelebrationCount');
        const weightInput = document.getElementById('weightInput');
        const youngDriverCheckbox = document.getElementById('youngDriverCheckbox');
        const bacDisplay = document.getElementById('bacDisplay');
        const drivingStatusDisplay = document.getElementById('drivingStatusDisplay');
        const soberUpTimeDisplay = document.getElementById('soberUpTimeDisplay');
        const driveTimeDisplay = document.getElementById('driveTimeDisplay');

        // Références aux éléments des paliers de la jauge
        const milestone1 = document.getElementById('milestone1');
        const milestone2 = document.getElementById('milestone2');
        const milestone3 = document.getElementById('milestone3');
        const milestone1Text = document.getElementById('milestone1Text');
        const milestone2Text = document.getElementById('milestone2Text');
        const milestone3Text = document.getElementById('milestone3Text');

        // Références aux boutons et contenus des onglets
        const tabCounter = document.getElementById('tabCounter');
        const tabObjective = document.getElementById('tabObjective');
        const tabBAC = document.getElementById('tabBAC');
        const tabGame = document.getElementById('tabGame');
        const tabSettings = document.getElementById('tabSettings');

        const contentCounter = document.getElementById('contentCounter');
        const contentObjective = document.getElementById('contentObjective');
        const contentBAC = document.getElementById('contentBAC');
        const contentGame = document.getElementById('contentGame');
        const contentSettings = document.getElementById('contentSettings');


        // Références pour l'écran Action ou Vérité
        const actionOrTruthScreen = document.getElementById('actionOrTruthScreen');
        const actionButton = document.getElementById('actionButton');
        const truthButton = document.getElementById('truthButton');
        const challengeDisplay = document.getElementById('challengeDisplay');
        const doneButton = document.getElementById('doneButton');

        // Références pour le jeu
        const gameScoreDisplay = document.getElementById('gameScoreDisplay');
        const gameTimerDisplay = document.getElementById('gameTimerDisplay');
        const startGameButton = document.getElementById('startGameButton');
        const gameArea = document.getElementById('gameArea');
        const gameResultDisplay = document.getElementById('gameResultDisplay');
        const finalGameScore = document.getElementById('finalGameScore');
        const highGameScore = document.getElementById('highGameScore');
        const playAgainButton = document.getElementById('playAgainButton');

        // Référence pour le message du record sur le compteur
        const recordToBeat = document.getElementById('recordToBeat');

        // Références pour les toggles des paramètres
        // const ohYeahSoundToggle = document.getElementById('ohYeahSoundToggle'); // Supprimé
        const actionOrTruthToggle = document.getElementById('actionOrTruthToggle');


        // Initialisation du compteur et de l'objectif
        let jagerbombCount = 0;
        let previousJagerbombCount = 0;
        let objective = 50;

        // Flags pour suivre si les paliers de la jauge ont été atteints pour la célébration
        let milestone1Reached = false;
        let milestone2Reached = false;
        let milestone3Reached = false;

        // Constantes pour le calcul d'alcoolémie
        const JAG_ML = 30; 
        const JAG_ABV = 0.35; 
        const ETHANOL_DENSITY = 0.789;
        const MALE_R_FACTOR = 0.68; 
        const ELIMINATION_RATE = 0.12; 

        // Limites légales d'alcoolémie en g/L
        const LEGAL_LIMIT_STANDARD = 0.5;
        const LEGAL_LIMIT_YOUNG_DRIVER = 0.2;

        // Base de données d'actions et de vérités (MISES À JOUR)
        const actions = [
            "Fais un air-guitar épique avec une bouteille vide.",
            "Imite ton professeur le plus ennuyeux en racontant une blague culte.",
            "Tente de faire 5 pompes en chantant l'hymne national.",
            "Fais un compliment sincère à la personne la plus improbable de la pièce.",
            "Danse le limbo sous une règle, sans la faire tomber.",
            "Écris un haïku sur la soirée actuelle.",
            "Fais une déclaration d'amour passionnée à ton verre (vide ou plein).",
            "Essaie de lécher ton coude (sans tricher, c'est impossible !).",
            "Parle avec un accent étranger jusqu'à ton prochain Jägerbomb.",
            "Fais 10 jumping jacks en criant le nom de ton animal totem.",
            "Demande à quelqu'un de te raconter son rêve le plus bizarre.",
            "Fais le bruit d'un animal de la ferme à chaque fois que tu ris pendant 5 minutes.",
            "Chante le refrain d'une chanson paillarde à tue-tête.",
            "Fais une grimace et garde-la jusqu'à ce que quelqu'un la remarque.",
            "Tente de faire un tour de magie raté, mais avec conviction.",
            "Fais un high-five avec 3 personnes que tu ne connais pas encore.",
            "Raconte une anecdote embarrassante sur toi-même (la plus drôle possible).",
            "Fais une chorégraphie improvisée sur une musique imaginaire.",
            "Demande à quelqu's de te donner un défi, et exécute-le (dans les limites du respect et de la sécurité).",
            "Fais le bruit d'une sirène de pompier et cours sur place pendant 10 secondes."
        ];

        const truths = [
            "Quelle est la chose la plus folle que tu aies faite en soirée et que tu regrettes un peu ?",
            "Si tu devais te réveiller demain matin dans le corps de quelqu'un d'autre ici, qui choisirais-tu et pourquoi ?",
            "Quel est ton 'guilty pleasure' le plus inavouable en matière de musique ou de film ?",
            "As-tu déjà menti pour éviter une situation sociale ? Si oui, laquelle ?",
            "Quelle est la chose la plus embarrassante que tes parents t'aient racontée sur toi ?",
            "Si tu pouvais avoir un rendez-vous avec n'importe quelle célébrité, morte ou vivante, qui choisirais-tu ?",
            "Quel est le secret le plus bizarre que tu aies gardé pour quelqu'un d'autre ?",
            "As-tu déjà eu un crush sur un ami très proche ? Si oui, est-ce toujours le cas ?",
            "Quelle est la chose la plus illégale (mais pas trop grave !) que tu aies faite ?",
            "Si tu pouvais changer une chose à propos de ta vie amoureuse passée, quelle serait-elle ?",
            "Quelle est la pire excuse que tu aies donnée pour ne pas aller en cours/travail ?",
            "As-tu déjà triché à un examen ? Si oui, comment ?",
            "Quel est le rêve le plus étrange ou le plus coquin que tu aies fait ?",
            "Si tu pouvais avoir un super-pouvoir, mais qu'il soit totalement inutile, lequel choisirais-tu ?",
            "Quelle est la chose la plus ridicule que you aies achetée et que tu utilises encore ?",
            "As-tu déjà envoyé un message gênant à la mauvaise personne ?",
            "Quel est ton plus grand fantasme secret ?",
            "Si tu devais choisir une seule boisson pour le reste de ta vie, quelle serait-elle ?",
            "Quelle est la chose la plus folle que tu aies faite pour impressionner quelqu'un ?",
            "As-tu déjà volé quelque chose (même petit) ? Si oui, quoi ?"
        ];

        // Variables pour les paramètres (avec valeurs par défaut)
        // let ohYeahSoundEnabled = true; // Supprimé
        let actionOrTruthEnabled = true;

        // Configuration et initialisation de Tone.js pour les sons
        let synth;
        // let ohYeahPlayer; // Supprimé

        async function setupAudio() {
            // Initialise le synthétiseur pour les sons de célébration généraux
            if (!synth) {
                synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: {
                        type: "sine"
                    },
                    envelope: {
                        attack: 0.01,
                        decay: 0.2,
                        sustain: 0.1,
                        release: 0.5
                    }
                }).toDestination();
            }
            // Le lecteur pour le son "Oh Yeah" et sa logique de chargement ont été supprimés.
            // Si vous souhaitez réintroduire un son personnalisé, vous devrez héberger le fichier MP3
            // sur un service de fichiers statiques (comme GitHub Pages) et le charger ici.
        }

        /**
         * Joue un son de célébration général.
         */
        function playCelebrationSound() {
            if (synth) {
                synth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "8n");
            }
        }

        /**
         * La fonction playOhYeahSound a été supprimée car le son "Oh Yeah" a été retiré.
         * Si vous la réintroduisez, assurez-vous qu'elle utilise un fichier audio hébergé.
         */
        // function playOhYeahSound() { ... } // Supprimé

        // Fonction pour charger les paramètres depuis le localStorage
        function loadSettings() {
            // const savedOhYeah = localStorage.getItem('ohYeahSoundEnabled'); // Supprimé
            const savedActionOrTruth = localStorage.getItem('actionOrTruthEnabled');

            // if (savedOhYeah !== null) { // Supprimé
            //     ohYeahSoundEnabled = JSON.parse(savedOhYeah); // Supprimé
            // } // Supprimé
            if (savedActionOrTruth !== null) {
                actionOrTruthEnabled = JSON.parse(savedActionOrTruth);
            }

            // Mettre à jour les checkboxes dans l'interface utilisateur
            // ohYeahSoundToggle.checked = ohYeahSoundEnabled; // Supprimé
            actionOrTruthToggle.checked = actionOrTruthEnabled;
        }

        // Fonction pour sauvegarder les paramètres dans le localStorage
        function saveSettings() {
            // localStorage.setItem('ohYeahSoundEnabled', JSON.stringify(ohYeahSoundEnabled)); // Supprimé
            localStorage.setItem('actionOrTruthEnabled', JSON.stringify(actionOrTruthEnabled));
        }

        // Écouteurs pour les toggles des paramètres
        // ohYeahSoundToggle.addEventListener('change', () => { // Supprimé
        //     ohYeahSoundEnabled = ohYeahSoundToggle.checked; // Supprimé
        //     saveSettings(); // Supprimé
        // }); // Supprimé

        actionOrTruthToggle.addEventListener('change', () => {
            actionOrTruthEnabled = actionOrTruthToggle.checked;
            saveSettings();
        });


        // Fonction pour changer d'onglet
        function changeTab(tabId) {
            // Masquer tous les contenus d'onglet
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.add('hidden');
            });
            // Désactiver tous les boutons d'onglet
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Afficher le contenu de l'onglet sélectionné
            document.getElementById(`content${tabId}`).classList.remove('hidden');
            // Activer le bouton de l'onglet sélectionné
            document.getElementById(`tab${tabId}`).classList.add('active');
        }

        // Écouteurs d'événements pour les boutons d'onglet
        tabCounter.addEventListener('click', () => changeTab('Counter'));
        tabObjective.addEventListener('click', () => changeTab('Objective'));
        tabBAC.addEventListener('click', () => changeTab('BAC'));
        tabGame.addEventListener('click', () => changeTab('Game'));
        tabSettings.addEventListener('click', () => changeTab('Settings')); // Écouteur pour le nouvel onglet Paramètres

        // Écouteurs pour la navigation entre les écrans
        startButton.addEventListener('click', async () => {
            // Démarre le contexte audio sur une interaction utilisateur
            await Tone.start();
            console.log("Audio context started!");

            welcomeScreen.classList.add('hidden');
            objectiveSettingScreen.classList.remove('hidden');
            initialObjectiveInput.value = objective;
            objectiveError.classList.add('hidden');
        });

        setObjectiveButton.addEventListener('click', () => {
            const newObjective = parseInt(initialObjectiveInput.value);
            if (!isNaN(newObjective) && newObjective > 0) {
                objective = newObjective;
                objectiveInput.value = newObjective;
                objectiveSettingScreen.classList.add('hidden');
                mainAppScreen.classList.remove('hidden');
                milestone1Reached = false;
                milestone2Reached = false;
                milestone3Reached = false;
                updateDisplay();
                changeTab('Counter');
                objectiveError.classList.add('hidden');
            } else {
                objectiveError.classList.remove('hidden');
            }
        });

        // Écouteur d'événements pour l'input de l'objectif dans l'onglet
        objectiveInput.addEventListener('input', () => {
            const newObjective = parseInt(objectiveInput.value);
            if (!isNaN(newObjective) && newObjective > 0) {
                if (jagerbombCount >= newObjective) {
                    previousJagerbombCount = jagerbombCount;
                }
                objective = newObjective;
                milestone1Reached = false;
                milestone2Reached = false;
                milestone3Reached = false;
                updateDisplay(); // Appelle updateDisplay pour tout rafraîchir
            } else {
                objective = 50;
                objectiveInput.value = 50;
                milestone1Reached = false;
                milestone2Reached = false;
                milestone3Reached = false;
                updateDisplay(); // Appelle updateDisplay pour tout rafraîchir
            }
        });

        // Écouteur d'événements pour l'input du poids et la checkbox jeune permis
        weightInput.addEventListener('input', updateBacCalculator);
        youngDriverCheckbox.addEventListener('change', updateBacCalculator);

        /**
         * Affiche l'écran Action ou Vérité.
         * @param {number} milestoneValue - La valeur du palier qui a été atteint.
         */
        function showActionOrTruthScreen(milestoneValue) {
            mainAppScreen.classList.add('hidden');
            actionOrTruthScreen.style.display = 'flex';
            playCelebrationSound();
            spawnConfettiEmojis(30, window.innerWidth / 2, window.innerHeight / 2, 0.8);
            challengeDisplay.textContent = "Choisis ton destin !";
        }

        /**
         * Cache l'écran Action ou Vérité.
         */
        function hideActionOrTruthScreen() {
            actionOrTruthScreen.style.display = 'none';
            mainAppScreen.classList.remove('hidden');
            challengeDisplay.textContent = "";
        }

        /**
         * Affiche une action aléatoire.
         */
        function displayRandomAction() {
            const randomIndex = Math.floor(Math.random() * actions.length);
            challengeDisplay.textContent = `Action : ${actions[randomIndex]}`;
        }

        /**
         * Affiche une vérité aléatoire.
         */
        function displayRandomTruth() {
            const randomIndex = Math.floor(Math.random() * truths.length);
            challengeDisplay.textContent = `Vérité : ${truths[randomIndex]}`;
        }

        // Écouteurs pour les boutons Action/Vérité et FAIT
        actionButton.addEventListener('click', displayRandomAction);
        truthButton.addEventListener('click', displayRandomTruth);
        doneButton.addEventListener('click', hideActionOrTruthScreen);


        /**
         * Met à jour l'affichage du compteur et de la jauge.
         * Déclenche également les célébrations si les paliers ou l'objectif sont atteints.
         */
        function updateDisplay() {
            countDisplay.textContent = jagerbombCount;
            updateGauge();
            updateBacCalculator();
            updateNextMilestoneDisplay();

            const milestone1Value = Math.round(objective * 0.33);
            const milestone2Value = Math.round(objective * 0.66);
            const milestone3Value = Math.round(objective * 0.90);

            // Célébration du palier 1
            if (jagerbombCount >= milestone1Value && !milestone1Reached) {
                if (milestone1Value > 0) {
                    // playOhYeahSound(); // Supprimé
                    if (actionOrTruthEnabled) {
                        showActionOrTruthScreen(milestone1Value);
                    } else {
                        spawnConfettiEmojis(30, window.innerWidth / 2, window.innerHeight / 2, 0.8);
                    }
                    milestone1Text.classList.add('milestone-text-active');
                    setTimeout(() => milestone1Text.classList.remove('milestone-text-active'), 1000);
                }
                milestone1Reached = true;
            }
            // Célébration du palier 2
            if (jagerbombCount >= milestone2Value && !milestone2Reached) {
                if (milestone2Value > 0) {
                    // playOhYeahSound(); // Supprimé
                    if (actionOrTruthEnabled) {
                        showActionOrTruthScreen(milestone2Value);
                    } else {
                        spawnConfettiEmojis(30, window.innerWidth / 2, window.innerHeight / 2, 0.8);
                    }
                    milestone2Text.classList.add('milestone-text-active');
                    setTimeout(() => milestone2Text.classList.remove('milestone-text-active'), 1000);
                }
                milestone2Reached = true;
            }
            // Célébration du palier 3
            if (jagerbombCount >= milestone3Value && !milestone3Reached) {
                if (milestone3Value > 0) {
                    // playOhYeahSound(); // Supprimé
                    if (actionOrTruthEnabled) {
                        showActionOrTruthScreen(milestone3Value);
                    } else {
                        spawnConfettiEmojis(30, window.innerWidth / 2, window.innerHeight / 2, 0.8);
                    }
                    milestone3Text.classList.add('milestone-text-active');
                    setTimeout(() => milestone3Text.classList.remove('milestone-text-active'), 1000);
                }
                milestone3Reached = true;
            }

            // Déclenche la célébration "objectif atteint" (beaucoup plus festive)
            if (jagerbombCount >= objective && previousJagerbombCount < objective) {
                showUltimateCelebration();
            }

            previousJagerbombCount = jagerbombCount;
        }

        /**
         * Met à jour le niveau de liquide dans la jauge de la bouteille Jägerbombs et les paliers.
         */
        function updateGauge() {
            if (objective === 0) {
                liquidLevel.style.height = '0%';
                milestone1.style.bottom = '0%';
                milestone2.style.bottom = '0%';
                milestone3.style.bottom = '0%';
                milestone1Text.textContent = '';
                milestone2Text.textContent = '';
                milestone3Text.textContent = '';
                return;
            }

            const percentage = Math.min(100, (jagerbombCount / objective) * 100);
            liquidLevel.style.height = `${percentage}%`;

            // Calcul et positionnement des 3 paliers
            const milestone1Value = Math.round(objective * 0.33);
            const milestone2Value = Math.round(objective * 0.66);
            const milestone3Value = Math.round(objective * 0.90);

            const m1Bottom = (milestone1Value / objective) * 100;
            const m2Bottom = (milestone2Value / objective) * 100;
            const m3Bottom = (milestone3Value / objective) * 100;

            milestone1.style.bottom = `${Math.min(m1Bottom, 99)}%`;
            milestone2.style.bottom = `${Math.min(m2Bottom, 99)}%`;
            milestone3.style.bottom = `${Math.min(m3Bottom, 99)}%`;

            // Afficher le texte du palier
            milestone1Text.textContent = `${milestone1Value}`;
            milestone2Text.textContent = `${milestone2Value}`;
            milestone3Text.textContent = `${milestone3Value}`;

            milestone1Text.style.display = 'block';
            milestone2Text.style.display = 'block';
            milestone3Text.style.display = 'block';
        }

        /**
         * Met à jour l'affichage du prochain palier sur l'onglet Compteur.
         */
        function updateNextMilestoneDisplay() {
            const milestone1Value = Math.round(objective * 0.33);
            const milestone2Value = Math.round(objective * 0.66);
            const milestone3Value = Math.round(objective * 0.90);

            let nextMilestone = null;
            let remainingJagerbombs = 0;

            if (jagerbombCount < milestone1Value) {
                nextMilestone = milestone1Value;
                remainingJagerbombs = nextMilestone - jagerbombCount;
            } else if (jagerbombCount < milestone2Value) {
                nextMilestone = milestone2Value;
                remainingJagerbombs = nextMilestone - jagerbombCount;
            } else if (jagerbombCount < milestone3Value) {
                nextMilestone = milestone3Value;
                remainingJagerbombs = nextMilestone - jagerbombCount;
            } else if (jagerbombCount < objective) {
                nextMilestone = objective;
                remainingJagerbombs = nextMilestone - jagerbombCount;
            } else {
                nextMilestoneDisplay.textContent = "Objectif atteint !";
                return;
            }

            if (nextMilestone !== null) {
                nextMilestoneDisplay.textContent = `Prochain palier : ${nextMilestone} Jägerbombs (${remainingJagerbombs} restants)`;
            } else {
                nextMilestoneDisplay.textContent = "Objectif atteint !";
            }
        }


        /**
         * Calcule et affiche l'alcoolémie estimée, le temps de décuvage et le statut de conduite.
         */
        function updateBacCalculator() {
            const weight = parseFloat(weightInput.value);
            const isYoungDriver = youngDriverCheckbox.checked;
            const currentLegalLimit = isYoungDriver ? LEGAL_LIMIT_YOUNG_DRIVER : LEGAL_LIMIT_STANDARD;

            if (isNaN(weight) || weight <= 0) {
                bacDisplay.textContent = "N/A";
                soberUpTimeDisplay.textContent = "N/A";
                drivingStatusDisplay.textContent = "Veuillez entrer votre poids.";
                drivingStatusDisplay.className = "text-2xl sm:text-3xl font-bold text-zinc-400";
                driveTimeDisplay.textContent = "--:--";
                return;
            }

            const alcoholPerJagerbomb_g = JAG_ML * JAG_ABV * ETHANOL_DENSITY;
            const totalAlcohol_g = jagerbombCount * alcoholPerJagerbomb_g;

            let bac = 0;
            if (weight > 0) {
                bac = totalAlcohol_g / (weight * MALE_R_FACTOR);
            }

            bacDisplay.textContent = bac.toFixed(2);

            if (bac <= currentLegalLimit) {
                drivingStatusDisplay.textContent = "Vous pouvez conduire";
                drivingStatusDisplay.className = "text-2xl sm:text-3xl font-bold text-green-500";
                soberUpTimeDisplay.textContent = "0h 00m";
                driveTimeDisplay.textContent = "Maintenant";
            } else {
                drivingStatusDisplay.textContent = "Vous ne pouvez PAS conduire";
                drivingStatusDisplay.className = "text-2xl sm:text-3xl font-bold text-red-500";

                const bacToEliminate = bac - currentLegalLimit;
                let timeToReachLimitHours = 0;
                if (bacToEliminate > 0) {
                    timeToReachLimitHours = bacToEliminate / ELIMINATION_RATE;
                }

                const hoursSoberUp = Math.floor(timeToReachLimitHours);
                const minutesSoberUp = Math.round((timeToReachLimitHours - hoursSoberUp) * 60);
                soberUpTimeDisplay.textContent = `${hoursSoberUp}h ${minutesSoberUp}m`;

                const currentTime = new Date();
                const futureTime = new Date(currentTime.getTime() + timeToReachLimitHours * 60 * 60 * 1000);

                const driveHours = futureTime.getHours().toString().padStart(2, '0');
                const driveMinutes = futureTime.getMinutes().toString().padStart(2, '0');
                driveTimeDisplay.textContent = `${driveHours}:${driveMinutes}`;
            }
        }

        /**
         * Génère des emojis festifs qui se dispersent et s'estompent pour simuler des feux d'artifice.
         */
        function spawnConfettiEmojis(numEmojis = 30, originX = window.innerWidth / 2, originY = window.innerHeight / 2, spreadFactor = 0.8) {
            const emojis = ['🎉', '🎆', '✨', '🍾', '🥳', '🎊', '🥂', '🍻', '🥃', '👯'];

            for (let i = 0; i < numEmojis; i++) {
                const emoji = document.createElement('span');
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emoji.classList.add('confetti-emoji');

                const startX = originX;
                const startY = originY;

                const endX = startX + (Math.random() - 0.5) * window.innerWidth * spreadFactor;
                const endY = startY + (Math.random() - 0.5) * window.innerHeight * spreadFactor;

                const rotation = Math.random() * 720 - 360;

                emoji.style.setProperty('--x', `${endX - startX}px`);
                emoji.style.setProperty('--y', `${endY - startY}px`);
                emoji.style.setProperty('--rotate', `${rotation}deg`);

                emoji.style.animationDelay = `${Math.random() * 0.5}s`;

                fireworksContainer.appendChild(emoji);

                emoji.addEventListener('animationend', () => {
                    emoji.remove();
                });
            }
        }

        /**
         * Affiche la célébration ultime en plein écran lorsque l'objectif est atteint.
         */
        function showUltimateCelebration() {
            ultimateCelebrationCount.textContent = `${jagerbombCount} Jägerbombs !`;
            ultimateCelebrationOverlay.classList.remove('hidden');
            ultimateCelebrationOverlay.classList.remove('opacity-0');
            ultimateCelebrationOverlay.classList.add('ultimate-celebration-active');

            playCelebrationSound();

            spawnConfettiEmojis(200, window.innerWidth / 2, window.innerHeight / 2, 1.8);

            setTimeout(() => {
                ultimateCelebrationOverlay.classList.add('opacity-0');
                ultimateCelebrationOverlay.classList.remove('ultimate-celebration-active');
                ultimateCelebrationOverlay.addEventListener('transitionend', () => {
                    ultimateCelebrationOverlay.classList.add('hidden');
                }, { once: true });
            }, 5000);
        }


        // Écouteurs d'événements pour les boutons d'incrémentation
        incrementButton.addEventListener('click', () => {
            previousJagerbombCount = jagerbombCount;
            jagerbombCount++;
            updateDisplay();
        });

        increment5Button.addEventListener('click', () => {
            previousJagerbombCount = jagerbombCount;
            jagerbombCount += 5;
            updateDisplay();
        });

        increment10Button.addEventListener('click', () => {
            previousJagerbombCount = jagerbombCount;
            jagerbombCount += 10;
            updateDisplay();
        });

        increment20Button.addEventListener('click', () => {
            previousJagerbombCount = jagerbombCount;
            jagerbombCount += 20;
            updateDisplay();
        });

        // Écouteur d'événement pour le bouton de remise à zéro
        resetButton.addEventListener('click', () => {
            jagerbombCount = 0;
            previousJagerbombCount = 0;
            milestone1Reached = false;
            milestone2Reached = false;
            milestone3Reached = false;
            updateDisplay();
        });

        // Variables et fonctions pour le jeu "Attrape le Jägerbomb !"
        let gameScore = 0;
        let gameTime = 30;
        let gameRunning = false;
        let spawnIntervalId;
        let timerIntervalId;
        let highScore = 0;

        /**
         * Démarre le jeu "Attrape le Jägerbomb !".
         */
        function startGame() {
            if (gameRunning) return;
            gameRunning = true;
            gameScore = 0;
            gameTime = 30;
            gameScoreDisplay.textContent = gameScore;
            gameTimerDisplay.textContent = `${gameTime}s`;
            gameArea.innerHTML = '';
            gameResultDisplay.classList.add('hidden');
            startGameButton.classList.add('hidden');

            timerIntervalId = setInterval(() => {
                gameTime--;
                gameTimerDisplay.textContent = `${gameTime}s`;
                if (gameTime <= 0) {
                    endGame();
                }
            }, 1000);

            spawnIntervalId = setInterval(spawnJagerbomb, 1000);
        }

        /**
         * Fait apparaître un Jägerbomb aléatoirement dans la zone de jeu.
         */
        function spawnJagerbomb() {
            if (!gameRunning) return;

            const jagerbombEmoji = document.createElement('span');
            jagerbombEmoji.textContent = '🍹';
            jagerbombEmoji.classList.add('absolute', 'text-4xl', 'cursor-pointer', 'transition-all', 'duration-100', 'hover:scale-125');

            const maxX = gameArea.clientWidth - 50;
            const maxY = gameArea.clientHeight - 50;
            const randomX = Math.random() * maxX;
            const randomY = Math.random() * maxY;

            jagerbombEmoji.style.left = `${randomX}px`;
            jagerbombEmoji.style.top = `${randomY}px`;

            jagerbombEmoji.addEventListener('click', () => {
                if (gameRunning) {
                    gameScore++;
                    gameScoreDisplay.textContent = gameScore;
                    jagerbombEmoji.remove();
                }
            });

            gameArea.appendChild(jagerbombEmoji);

            setTimeout(() => {
                if (jagerbombEmoji.parentNode === gameArea) {
                    jagerbombEmoji.remove();
                }
            }, 1500);
        }

        /**
         * Termine le jeu et affiche le score.
         */
        function endGame() {
            gameRunning = false;
            clearInterval(spawnIntervalId);
            clearInterval(timerIntervalId);
            gameArea.innerHTML = '';
            startGameButton.classList.remove('hidden');

            if (gameScore > highScore) {
                highScore = gameScore;
            }

            finalGameScore.textContent = gameScore;
            highGameScore.textContent = highScore;
            gameResultDisplay.classList.remove('hidden');
        }

        // Écouteur d'événement pour le bouton de démarrage du jeu
        startGameButton.addEventListener('click', startGame);
        // Écouteur d'événement pour le bouton "Rejouer"
        playAgainButton.addEventListener('click', startGame);


        // Mise à jour initiale de l'affichage, de la jauge et initialisation de l'audio au chargement de la page
        window.onload = () => {
            setupAudio(); // Initialise le contexte audio et les synthétiseurs
            loadSettings(); // Charge les paramètres sauvegardés
            updateDisplay(); // Met à jour l'affichage et les calculs initiaux
            
            welcomeScreen.classList.remove('hidden');
            objectiveSettingScreen.classList.add('hidden');
            mainAppScreen.classList.add('hidden');
            actionOrTruthScreen.style.display = 'none';
        };
    </script>
</body>
</html>
