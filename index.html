<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compteur Alcool & Drogues (Prévention)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align items to the top */
            min-height: 100vh;
            background: linear-gradient(135deg, #1f2937, #111827); /* Darker, subtle gradient */
            color: #e2e8f0; /* Light gray for general text */
            overflow-x: hidden;
            padding: 1.5rem; /* Increased padding */
        }

        .container-card {
            background-color: #2c3e50; /* Dark blue-gray for main cards */
            border: 1px solid #3b4b5c; /* Slightly lighter border */
            border-radius: 1.25rem; /* More rounded corners */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.4), 0 4px 10px -2px rgba(0, 0, 0, 0.2); /* Deeper shadow */
            padding: 1.5rem 1.75rem; /* Generous padding */
        }

        .tab-button-container {
            display: flex;
            border-bottom: 2px solid #4a5568; /* Darker border for tabs */
            margin-bottom: 1.5rem;
        }

        .tab-button {
            flex-grow: 1;
            text-align: center;
            padding: 0.85rem 1.25rem;
            color: #a0aec0; /* Lighter gray for inactive */
            border-bottom: 4px solid transparent; /* Thicker active indicator */
            cursor: pointer;
            font-weight: 600; /* Bolder */
            transition: all 0.3s ease-in-out;
            font-size: 1.1rem;
        }

        .tab-button:hover {
            color: #cbd5e0; /* Even lighter on hover */
        }
        
        .tab-button.active {
            color: #34d399; /* Vibrant green for active */
            border-bottom-color: #34d399; /* Matching border color */
            font-weight: 700; /* Extra bold */
        }
        
        .tab-pane {
            display: none;
        }
        .tab-pane.active {
            display: block;
        }

        .consumption-item {
            background-color: #37474f; /* Slightly lighter blue-gray for items */
            border: 1px solid #4a5568;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem; /* More rounded */
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            transition: transform 0.2s ease-out;
        }
        .consumption-item:hover {
            transform: translateY(-2px); /* Subtle lift on hover */
        }
        .consumption-item > div {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        .consumption-item-type-alcool { color: #81c784; } /* Lighter green */
        .consumption-item-type-drogue { color: #ffca28; } /* Amber */


        .prevention-message {
            background-color: #424242; /* Darker gray */
            color: #ffeb3b; /* Yellow for warning */
            padding: 1.25rem;
            border-radius: 0.75rem;
            margin-top: 2rem;
            text-align: center;
            font-size: 0.95rem;
            border: 1px solid #fdd835; /* Yellow border */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .custom-button {
            font-weight: bold;
            padding: 0.85rem 1.75rem; /* Larger padding */
            border-radius: 9999px;
            box-shadow: 0 6px 15px -3px rgba(0, 0, 0, 0.3), 0 3px 6px -2px rgba(0, 0, 0, 0.15); /* Stronger shadow */
            transition: all 0.3s ease-in-out;
            text-transform: uppercase; /* Uppercase text */
            letter-spacing: 0.05em; /* Slight letter spacing */
        }
        .custom-button:hover {
            transform: translateY(-3px) scale(1.02); /* More pronounced lift */
            box-shadow: 0 8px 20px -4px rgba(0, 0, 0, 0.4), 0 4px 8px -2px rgba(0, 0, 0, 0.2);
        }
        .custom-button:active {
            transform: translateY(0); /* Press down effect */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .custom-button:focus {
            outline: none;
            box-shadow: 0 0 0 5px rgba(52, 211, 153, 0.5); /* Green focus ring */
        }

        .button-green {
            background: linear-gradient(45deg, #10b981, #34d399); /* Green gradient */
            color: white;
        }
        .button-green:hover {
            background: linear-gradient(45deg, #059669, #10b981);
        }
        .button-green:focus {
            box-shadow: 0 0 0 5px rgba(52, 211, 153, 0.5);
        }

        .button-red {
            background: linear-gradient(45deg, #ef4444, #dc2626); /* Red gradient */
            color: white;
        }
        .button-red:hover {
            background: linear-gradient(45deg, #b91c1c, #ef4444);
        }
        .button-red:focus {
            box-shadow: 0 0 0 5px rgba(239, 68, 68, 0.5);
        }

        .button-blue {
            background: linear-gradient(45deg, #3b82f6, #2563eb); /* Blue gradient */
            color: white;
        }
        .button-blue:hover {
            background: linear-gradient(45deg, #1d4ed8, #3b82f6);
        }
        .button-blue:focus {
            box-shadow: 0 0 0 5px rgba(59, 130, 246, 0.5);
        }
        
        .form-input, .form-select {
            background-color: #37474f; /* Match item background */
            color: #e2e8f0;
            border: 1px solid #4a5568;
            border-radius: 0.5rem; /* More rounded */
            padding: 0.65rem 1rem;
            width: 100%;
            margin-bottom: 1rem;
            transition: all 0.2s ease-in-out;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #34d399; /* Green focus border */
            box-shadow: 0 0 0 3px rgba(52, 211, 153, 0.4); /* Green focus ring */
        }
        .bac-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #4a5568;
        }

        .quantity-input-list {
            background-color: #4a5568; /* Darker for list input */
            color: #e2e8f0;
            border: 1px solid #64748b;
            border-radius: 0.375rem;
            padding: 0.2rem 0.4rem;
            width: 4.5rem; /* Slightly wider */
            text-align: center;
            margin-left: 0.75rem;
            font-size: 0.9rem;
        }
        .quantity-input-list:focus {
            outline: none;
            border-color: #34d399;
            box-shadow: 0 0 0 2px rgba(52, 211, 153, 0.4);
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85); /* Darker overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1.5rem;
        }

        .modal-content {
            background-color: #2c3e50; /* Match main card */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.5), 0 5px 15px -3px rgba(0, 0, 0, 0.3);
            max-width: 550px; /* Slightly larger */
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid #4a5568;
        }

        .modal-close-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.8rem; /* Larger close button */
            color: #a0aec0;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
        }
        .modal-close-button:hover {
            color: #e2e8f0;
            transform: rotate(90deg); /* Spin on hover */
        }
        .modal-title {
            font-size: 1.8rem; /* Larger title */
            font-weight: bold;
            color: #ffca28; /* Amber for modal titles */
            margin-bottom: 1.25rem;
            padding-right: 2.5rem;
        }
        .modal-body {
            color: #e2e8f0;
            line-height: 1.7; /* Increased line height */
            font-size: 1rem;
        }
        .modal-body ul {
            list-style-type: '👉 '; /* Custom bullet point */
            margin-left: 1.5rem;
            margin-top: 0.75rem;
        }
        .modal-body li {
            margin-bottom: 0.6rem;
        }

        /* Suggestions list styles */
        .suggestions-list {
            position: absolute;
            background-color: #37474f; /* Match input background */
            border: 1px solid #4a5568;
            border-radius: 0.5rem;
            max-height: 180px; /* Taller list */
            overflow-y: auto;
            width: calc(100% - 2rem); 
            z-index: 10; 
            margin-top: -0.5rem; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .suggestion-item {
            padding: 0.6rem 1rem;
            cursor: pointer;
            color: #e2e8f0;
            transition: background-color 0.2s ease-in-out;
        }

        .suggestion-item:hover {
            background-color: #4a5568; /* Darker on hover */
        }

        /* Purity Test specific styles */
        .purity-question-container {
            min-height: 150px; /* Ensure space for question */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .purity-question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 1.5rem;
        }
        .purity-buttons-fixed-width { /* New class for fixed button width */
            width: 100%; /* Take full width of parent */
            max-width: 300px; /* Max width for buttons container */
            display: flex;
            justify-content: space-around; /* Space out buttons */
            align-items: center;
            margin-top: 1.5rem;
            gap: 1rem; /* Space between buttons */
        }
        .purity-buttons-fixed-width .custom-button {
            flex-grow: 1; /* Allow buttons to grow and fill space */
            min-width: 100px; /* Minimum width for each button */
        }

        .purity-results {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #4a5568;
        }
        .purity-results-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        .purity-results-item span:first-child {
            font-weight: 600;
        }
        .purity-results-item span:last-child {
            color: #34d399; /* Green for scores */
            font-weight: bold;
        }
        .purity-results-item.total span:last-child {
            color: #ffca28; /* Amber for total score */
            font-size: 1.4rem;
        }
        .purity-comment {
            margin-top: 1.5rem;
            font-style: italic;
            color: #cbd5e0;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Modal Tab Specific Styles */
        .modal-tab-button-container {
            display: flex;
            border-bottom: 2px solid #4a5568;
            margin-bottom: 1rem;
        }

        .modal-tab-button {
            flex-grow: 1;
            text-align: center;
            padding: 0.6rem 1rem;
            color: #a0aec0;
            border-bottom: 3px solid transparent; /* Slightly thinner active indicator */
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            font-size: 0.95rem;
        }

        .modal-tab-button:hover {
            color: #cbd5e0;
        }
        
        .modal-tab-button.active {
            color: #34d399;
            border-bottom-color: #34d399;
            font-weight: 700;
        }
        
        .modal-tab-pane {
            display: none;
        }
        .modal-tab-pane.active {
            display: block;
        }
    </style>
</head>
<body class="p-4">
    <div class="flex flex-col items-center justify-start w-full max-w-4xl mx-auto"> 
        <div id="welcomeScreen" class="container-card text-center w-full">
            <h1 class="text-4xl sm:text-5xl font-extrabold mb-6 text-green-400">
                Compteur Alcool & Drogues 🚀
            </h1>
            <p class="text-md sm:text-lg mb-4 text-gray-300">
                Cette application est un outil de suivi à but préventif. Elle vous permet de noter vos consommations et de faire un test de pureté. 📝
            </p>
            <p class="text-sm mb-8 text-yellow-300">
                Attention : Abuser de l'alcool et consommer des drogues est dangereux pour la santé. Si vous avez besoin d'aide, parlez-en. 🚨
            </p>
            <button id="startButton" class="w-full custom-button button-green">
                Commencer le suivi ✨
            </button>
        </div>

        <div id="mainAppScreen" class="container-card w-full hidden">
            <div class="tab-button-container">
                <button id="tabAlcoolButton" class="tab-button active" data-tab="alcool">Alcool 🍺</button>
                <button id="tabDrogueButton" class="tab-button" data-tab="drogue">Drogues 💊</button>
                <button id="tabPureteButton" class="tab-button" data-tab="purete">Test de Pureté ✨</button>
            </div>
            
            <div class="flex flex-col lg:flex-row lg:gap-8">
                <div class="lg:w-1/2">
                    <div id="tabAlcoolPane" class="tab-pane active">
                        <h2 class="text-2xl font-semibold mb-4 text-green-300">Ajouter une consommation d'alcool 🍷</h2>
                        <div class="mb-4 relative">
                            <label for="searchAlcoolInput" class="block text-sm font-medium text-gray-300 mb-1">Rechercher un alcool :</label>
                            <input type="text" id="searchAlcoolInput" placeholder="Ex: Bière, Mojito, Vodka..." class="form-input">
                            <div id="alcoolSuggestions" class="suggestions-list hidden"></div>
                        </div>
                        <div class="mb-4">
                            <label for="volumeAlcoolInput" class="block text-sm font-medium text-gray-300 mb-1">Volume par unité (ml) :</label>
                            <input type="number" id="volumeAlcoolInput" value="1" min="1" class="form-input">
                        </div>
                        <div class="mb-4">
                            <label for="quantityAlcoolInput" class="block text-sm font-medium text-gray-300 mb-1">Nombre de verres/unités :</label>
                            <input type="number" id="quantityAlcoolInput" value="1" min="1" class="form-input">
                        </div>
                        <button id="addAlcoolButton" class="w-full custom-button button-green mb-6">
                            Ajouter Alcool ➕
                        </button>
                    </div>

                    <div id="tabDroguePane" class="tab-pane">
                        <h2 class="text-2xl font-semibold mb-4 text-yellow-300">Ajouter une consommation de drogue 🌿</h2>
                        <div class="mb-4 relative">
                            <label for="searchDrogueInput" class="block text-sm font-medium text-gray-300 mb-1">Rechercher une drogue :</label>
                            <input type="text" id="searchDrogueInput" placeholder="Ex: Cannabis, Cocaïne..." class="form-input">
                            <div id="drogueSuggestions" class="suggestions-list hidden"></div>
                        </div>
                        <div class="mb-4 flex items-end justify-end">
                            <button id="showDrugAdviceButton" class="custom-button button-blue px-4 py-2 text-sm rounded-md h-10 flex-shrink-0" disabled>
                                Conseils sur la drogue sélectionnée 💡
                            </button>
                        </div>
                        <div class="mb-4">
                            <label for="quantityDrogueInput" class="block text-sm font-medium text-gray-300 mb-1">Quantité (unités/prises) :</label>
                            <input type="number" id="quantityDrogueInput" value="1" min="1" class="form-input">
                        </div>
                        <button id="addDrogueButton" class="w-full custom-button button-green mb-6">
                            Ajouter Drogue ➕
                        </button>
                        <p class="text-sm text-gray-400 text-center">Le suivi des drogues est qualitatif. Il n'y a pas de calcul de "taux" pour les drogues dans cette application. 🚫</p>
                    </div>

                    <div id="tabPuretePane" class="tab-pane">
                        <h2 class="text-2xl font-semibold mb-4 text-purple-300">Test de Pureté Griffor ✨</h2>
                        <p class="text-sm text-gray-300 mb-4">Cochez toutes les cases qui s'appliquent à vous. Chaque case cochée réduit votre score de pureté. Un score de 100% signifie une pureté totale dans cette catégorie.</p>
                        
                        <div id="purityTestIntro" class="text-center mb-6">
                            <p class="text-lg text-gray-200 mb-4">Prêt à découvrir votre score de pureté ?</p>
                            <button id="startPurityTestButton" class="custom-button button-blue">
                                Commencer le test de pureté ▶️
                            </button>
                        </div>

                        <div id="purityTestQuestionsContainer" class="hidden">
                            <div class="purity-question-container">
                                <p id="currentPurityQuestion" class="purity-question-text"></p>
                                <div class="purity-buttons-fixed-width"> 
                                    <button id="purityAnswerYes" class="custom-button button-red">Oui 😈</button>
                                    <button id="purityAnswerNo" class="custom-button button-green">Non 😇</button>
                                </div>
                            </div>
                            <span id="purityQuestionCounter" class="text-gray-400 text-sm flex justify-center items-center mt-4"></span>
                        </div>

                        <div id="purityResults" class="purity-results hidden">
                            <h3 class="text-xl font-semibold mb-3 text-purple-300">Vos résultats :</h3>
                            <div id="purityScoresSummary">
                            </div>
                            <p id="purityComment" class="purity-comment"></p> 
                            <div class="mt-6">
                                <canvas id="purityChart"></canvas>
                            </div>
                            <button id="restartPurityTestButton" class="w-full custom-button button-red mt-6">
                                Refaire le test 🔄
                            </button>
                        </div>
                    </div>
                </div>

                <div id="sideContent" class="lg:w-1/2">
                    <div id="bacCalculatorSection" class="bac-section">
                        <h2 class="text-2xl font-semibold mb-4 text-green-300">Calculateur d'Alcoolémie (Estimation) 📊</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="weightInput" class="block text-sm font-medium text-gray-300 mb-1">Votre poids (kg) :</label>
                                <input type="number" id="weightInput" value="70" min="20" class="form-input">
                            </div>
                            <div>
                                <label for="genderSelect" class="block text-sm font-medium text-gray-300 mb-1">Votre genre :</label>
                                <select id="genderSelect" class="form-select">
                                    <option value="male">Homme 👨</option>
                                    <option value="female">Femme 👩</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex items-center justify-start md:justify-center mt-2 md:mt-5 mb-4">
                            <input type="checkbox" id="youngDriverCheckbox" class="form-checkbox h-5 w-5 text-green-600 rounded mr-2 focus:ring-green-500">
                            <label for="youngDriverCheckbox" class="text-sm text-gray-300">Jeune permis (-3 ans) 🚗💨</label>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                            <div class="text-center p-3 bg-gray-700 rounded-lg shadow-inner">
                                <p class="text-sm text-gray-400 mb-1">Alcoolémie (g/L)</p>
                                <div id="bacDisplay" class="text-3xl font-bold text-yellow-300">0.00</div>
                            </div>
                            <div class="text-center p-3 bg-gray-700 rounded-lg shadow-inner">
                                <p class="text-sm text-gray-400 mb-1">Statut Conduite</p>
                                <div id="drivingStatusDisplay" class="text-xl font-semibold">--</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="text-center p-3 bg-gray-700 rounded-lg shadow-inner">
                                <p class="text-sm text-gray-400 mb-1">Dégrisement dans</p>
                                <div id="soberUpTimeDisplay" class="text-xl font-semibold text-blue-300">0h 00m</div>
                            </div>
                            <div class="text-center p-3 bg-gray-700 rounded-lg shadow-inner">
                                <p class="text-sm text-gray-400 mb-1">Conduite possible à</p>
                                <div id="driveTimeDisplay" class="text-xl font-semibold text-green-300">--:--</div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-3 text-center">Basé sur ~10g d'alcool/unité et une élimination de 0.15 g/L/h (homme moyen). Ces calculs sont des estimations et ne doivent pas être utilisés à des fins légales. ⚠️</p>
                    </div>

                    <div id="consumptionSummarySection" class="mt-8 pt-6 border-t border-gray-700">
                        <h2 class="text-2xl font-semibold mb-3 text-gray-200">Consommations enregistrées : 📋</h2>
                        <div id="consumptionList" class="max-h-48 overflow-y-auto mb-4 bg-gray-900 p-3 rounded-md border border-gray-700">
                            <p id="emptyListMessage" class="text-gray-400 text-center">Aucune consommation pour le moment. 😌</p>
                        </div>
                        
                        <div class="text-xl font-semibold mb-6 text-gray-200 text-right">
                            Total unités globales : <span id="totalUnitsCount" class="text-orange-400">0</span> 🎯
                        </div>

                        <button id="resetButton" class="w-full custom-button button-red">
                            Réinitialiser la liste 🗑️
                        </button>
                    </div>
                </div>
            </div>

            <div class="prevention-message">
                <p><strong>Rappel Prévention :</strong> La consommation de substances psychoactives comporte des risques. Soyez conscient de vos limites. En cas de problème, des aides existent (médecin, associations, numéros d'écoute). 🙏</p>
            </div>
        </div>
    </div>

    <div id="drugAdviceModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-button" id="closeDrugAdviceModal">✕</button>
            <h3 class="modal-title" id="drugAdviceTitle"></h3>
            
            <div class="modal-tab-button-container">
                <button id="modalTabUsage" class="modal-tab-button active" data-modal-tab="usage">Conseils de prise ✅</button>
                <button id="modalTabRisks" class="modal-tab-button" data-modal-tab="risks">Risques liés 🚨</button>
            </div>

            <div id="modalTabUsagePane" class="modal-tab-pane active modal-body"></div>
            <div id="modalTabRisksPane" class="modal-tab-pane modal-body"></div>
            </div>
    </div>

    <script>
        // DOM Elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const startButton = document.getElementById('startButton');
        const mainAppScreen = document.getElementById('mainAppScreen');
        
        const tabAlcoolButton = document.getElementById('tabAlcoolButton');
        const tabDrogueButton = document.getElementById('tabDrogueButton');
        const tabPureteButton = document.getElementById('tabPureteButton'); 
        const tabAlcoolPane = document.getElementById('tabAlcoolPane');
        const tabDroguePane = document.getElementById('tabDroguePane');
        const tabPuretePane = document.getElementById('tabPuretePane'); 
        const bacCalculatorSection = document.getElementById('bacCalculatorSection'); 
        const consumptionSummarySection = document.getElementById('consumptionSummarySection'); 

        const searchAlcoolInput = document.getElementById('searchAlcoolInput'); 
        const alcoolSuggestionsDiv = document.getElementById('alcoolSuggestions'); 
        const volumeAlcoolInput = document.getElementById('volumeAlcoolInput'); 
        const quantityAlcoolInput = document.getElementById('quantityAlcoolInput');
        const addAlcoolButton = document.getElementById('addAlcoolButton');

        const searchDrogueInput = document.getElementById('searchDrogueInput'); 
        const drogueSuggestionsDiv = document.getElementById('drogueSuggestions'); 
        const quantityDrogueInput = document.getElementById('quantityDrogueInput');
        const addDrogueButton = document.getElementById('addDrogueButton');
        const showDrugAdviceButton = document.getElementById('showDrugAdviceButton');

        const consumptionListDiv = document.getElementById('consumptionList');
        const emptyListMessage = document.getElementById('emptyListMessage');
        const resetButton = document.getElementById('resetButton');
        const totalUnitsCount = document.getElementById('totalUnitsCount');

        // BAC Calculator Elements
        const weightInput = document.getElementById('weightInput');
        const genderSelect = document.getElementById('genderSelect'); 
        const youngDriverCheckbox = document.getElementById('youngDriverCheckbox');
        const bacDisplay = document.getElementById('bacDisplay');
        const drivingStatusDisplay = document.getElementById('drivingStatusDisplay');
        const soberUpTimeDisplay = document.getElementById('soberUpTimeDisplay');
        const driveTimeDisplay = document.getElementById('driveTimeDisplay');

        // Drug Advice Modal Elements
        const drugAdviceModal = document.getElementById('drugAdviceModal');
        const drugAdviceTitle = document.getElementById('drugAdviceTitle');
        const modalTabUsageButton = document.getElementById('modalTabUsage'); // New
        const modalTabRisksButton = document.getElementById('modalTabRisks'); // New
        const modalTabUsagePane = document.getElementById('modalTabUsagePane'); // New
        const modalTabRisksPane = document.getElementById('modalTabRisksPane'); // New
        const closeDrugAdviceModalButton = document.getElementById('closeDrugAdviceModal');

        // Purity Test Elements
        const purityTestIntro = document.getElementById('purityTestIntro');
        const startPurityTestButton = document.getElementById('startPurityTestButton');
        const purityTestQuestionsContainer = document.getElementById('purityTestQuestionsContainer');
        const currentPurityQuestion = document.getElementById('currentPurityQuestion');
        const purityAnswerYesButton = document.getElementById('purityAnswerYes');
        const purityAnswerNoButton = document.getElementById('purityAnswerNo');
        const purityQuestionCounter = document.getElementById('purityQuestionCounter');
        const purityResultsDiv = document.getElementById('purityResults');
        const purityScoresSummaryDiv = document.getElementById('purityScoresSummary');
        const purityChartCanvas = document.getElementById('purityChart');
        const restartPurityTestButton = document.getElementById('restartPurityTestButton');
        const purityComment = document.getElementById('purityComment'); 
        let purityChartInstance = null; 

        let currentQuestionIndex = 0;
        let purityAnswers = {}; 


        // Global variables to hold selected item data
        let selectedAlcoolItem = null;
        let selectedDrogueItem = null;


        // Substance Data - EXTENDED AND DEDUPLICATED DATABASE
        const rawAlcoolData = [
            // Bières
            { name: "Bière Blonde Standard", degree: 5, unitVolume: 250 }, // 25cl
            { name: "Bière Ambrée", degree: 6, unitVolume: 250 },
            { name: "Bière Brune", degree: 7, unitVolume: 250 },
            { name: "Bière Blanche", degree: 4.5, unitVolume: 250 },
            { name: "Bière IPA", degree: 6.5, unitVolume: 330 },
            { name: "Bière Forte", degree: 8, unitVolume: 250 },
            { name: "Guinness Draught", degree: 4.2, unitVolume: 250 },
            { name: "Heineken", degree: 5, unitVolume: 250 },
            { name: "Leffe Blonde", degree: 6.6, unitVolume: 250 },
            { name: "Corona Extra", degree: 4.5, unitVolume: 250 },
            { name: "Desperados Original", degree: 5.9, unitVolume: 250 },
            { name: "Kronenbourg 1664", degree: 5.5, unitVolume: 250 },
            { name: "Grimbergen Blonde", degree: 6.7, unitVolume: 250 },
            { name: "Hoegaarden Blanche", degree: 4.9, unitVolume: 250 },
            { name: "Affligem Triple", degree: 9, unitVolume: 330 },
            { name: "Chimay Rouge", degree: 7, unitVolume: 330 },
            { name: "Duvel", degree: 8.5, unitVolume: 330 },
            { name: "Kriek Lindemans", degree: 3.5, unitVolume: 250 },
            { name: "Pelforth Blonde", degree: 5.8, unitVolume: 250 },
            { name: "Punk IPA", degree: 5.6, unitVolume: 330 },
            { name: "Brewdog Elvis Juice", degree: 6.5, unitVolume: 330 },
            { name: "Trappe Triple", degree: 8, unitVolume: 330 },
            { name: "Delirium Tremens", degree: 8.5, unitVolume: 330 },
            { name: "Tripel Karmeliet", degree: 8.4, unitVolume: 330 },
            { name: "Westmalle Dubbel", degree: 7, unitVolume: 330 },
            { name: "Orval", degree: 6.2, unitVolume: 330 },
            { name: "Rochefort 8", degree: 9.2, unitVolume: 330 },
            { name: "La Chouffe", degree: 8, unitVolume: 330 },
            { name: "Corsaire IPA", degree: 6, unitVolume: 330 },
            { name: "Jenlain Blonde", degree: 6.8, unitVolume: 250 },
            { name: "Gallia Parisienne", degree: 5.5, unitVolume: 330 },
            { name: "Meteor Pils", degree: 5, unitVolume: 250 },
            { name: "Stella Artois", degree: 5.2, unitVolume: 250 },
            { name: "Budweiser", degree: 5, unitVolume: 330 },
            { name: "Miller Lite", degree: 4.2, unitVolume: 355 },
            { name: "Coors Light", degree: 4.2, unitVolume: 355 },
            { name: "Pilsner Urquell", degree: 4.4, unitVolume: 330 },
            { name: "Peroni Nastro Azzurro", degree: 5.1, unitVolume: 330 },
            { name: "Asahi Super Dry", degree: 5.2, unitVolume: 330 },
            { name: "Sapporo Premium", degree: 5, unitVolume: 355 },
            { name: "Tiger Beer", degree: 5, unitVolume: 330 },
            { name: "Singha Beer", degree: 5, unitVolume: 330 },
            { name: "Tsingtao Beer", degree: 4.7, unitVolume: 330 },
            { name: "San Miguel", degree: 5, unitVolume: 330 },
            { name: "Estrella Damm", degree: 5.4, unitVolume: 330 },
            { name: "Dos Equis Lager", degree: 4.2, unitVolume: 355 },
            { name: "Modelo Especial", degree: 4.4, unitVolume: 355 },
            { name: "Negra Modelo", degree: 5.4, unitVolume: 355 },
            { name: "Pacifico Clara", degree: 4.5, unitVolume: 355 },
            { name: "Victoria Cerveza", degree: 4, unitVolume: 355 },
            { name: "Sol Cerveza", degree: 4.5, unitVolume: 330 },
            { name: "Tecate", degree: 4.5, unitVolume: 355 },
            { name: "Kirin Ichiban", degree: 5, unitVolume: 330 },
            { name: "Sapporo Reserve", degree: 5.2, unitVolume: 355 },
            { name: "Carlsberg", degree: 5, unitVolume: 250 },
            { name: "Tuborg Green", degree: 4.6, unitVolume: 250 },
            { name: "Grolsch", degree: 5, unitVolume: 250 },
            { name: "Amstel", degree: 5, unitVolume: 250 },
            { name: "Staropramen", degree: 5, unitVolume: 330 },
            { name: "Velkopopovicky Kozel", degree: 4.6, unitVolume: 330 },
            { name: "Zubr", degree: 5.5, unitVolume: 330 },
            { name: "Okocim", degree: 5.6, unitVolume: 330 },
            { name: "Tyskie", degree: 5.5, unitVolume: 330 },
            { name: "Lech", degree: 5.2, unitVolume: 330 },
            { name: "Zywiec", degree: 5.6, unitVolume: 330 },
            { name: "Baltika 3", degree: 4.8, unitVolume: 500 },
            { name: "Baltika 7", degree: 5.4, unitVolume: 500 },
            { name: "Baltika 9", degree: 8, unitVolume: 500 },
            { name: "Efes Pilsen", degree: 5, unitVolume: 330 },
            { name: "Mythos", degree: 4.7, unitVolume: 330 },
            { name: "Fix Hellas", degree: 5, unitVolume: 330 },
            { name: "Keo", degree: 4.5, unitVolume: 330 },
            { name: "Cisk Lager", degree: 4.2, unitVolume: 330 },
            { name: "Skol Lager", degree: 4.7, unitVolume: 330 },
            { name: "Super Bock", degree: 5.2, unitVolume: 250 },
            { name: "Sagres", degree: 5.1, unitVolume: 250 },
            { name: "Cristal Lager", degree: 5, unitVolume: 250 },
            { name: "Polar Pilsen", degree: 5, unitVolume: 250 },
            { name: "Brahma Chopp", degree: 5, unitVolume: 355 },
            { name: "Antarctica Original", degree: 4.9, unitVolume: 355 },
            { name: "Quilmes Cristal", degree: 4.9, unitVolume: 340 },
            { name: "Paceña", degree: 4.6, unitVolume: 330 },
            { name: "Cusqueña", degree: 4.8, unitVolume: 330 },
            { name: "Club Colombia", degree: 4.7, unitVolume: 330 },
            { name: "Aguila", degree: 4.5, unitVolume: 330 },
            { name: "Poker Cerveza", degree: 4.5, unitVolume: 330 },
            { name: "Pilsener (El Salvador)", degree: 4.2, unitVolume: 330 },
            { name: "Presidente (Dominican Rep.)", degree: 5, unitVolume: 355 },
            { name: "Red Stripe", degree: 4.7, unitVolume: 330 },
            { name: "Banks Beer", degree: 4.7, unitVolume: 275 },
            { name: "Carib Lager", degree: 5.2, unitVolume: 275 },
            { name: "Kalik", degree: 5, unitVolume: 355 },
            { name: "Soca Beer", degree: 4.7, unitVolume: 330 },
            { name: "Pitón", degree: 5, unitVolume: 275 },
            { name: "Wadadli", degree: 4.8, unitVolume: 275 },
            { name: "Stag Lager", degree: 5.5, unitVolume: 275 },
            { name: "Tiger Crystal", degree: 4.6, unitVolume: 330 },
            { name: "Chang Beer", degree: 5, unitVolume: 330 },
            { name: "Leo Beer", degree: 5, unitVolume: 330 },
            { name: "Bintang", degree: 4.7, unitVolume: 330 },
            { name: "Anchor Beer", degree: 4.5, unitVolume: 330 },
            { name: "Saigon Beer", degree: 4.9, unitVolume: 330 },
            { name: "Hanoi Beer", degree: 5.1, unitVolume: 330 },
            { name: "333 Beer", degree: 5.3, unitVolume: 330 },
            { name: "Larue Beer", degree: 4.2, unitVolume: 330 },
            { name: "Tiger Gold Medal", degree: 5, unitVolume: 330 },
            { name: "Kingfisher Premium", degree: 4.8, unitVolume: 330 },
            { name: "Haywards 5000", degree: 7, unitVolume: 330 },
            { name: "Foster's Lager", degree: 4.9, unitVolume: 375 },
            { name: "VB (Victoria Bitter)", degree: 4.9, unitVolume: 375 },
            { name: "Carlton Draught", degree: 4.6, unitVolume: 375 },
            { name: "Tooheys New", degree: 4.6, unitVolume: 375 },
            { name: "XXXX Gold", degree: 3.5, unitVolume: 375 },
            { name: "Coopers Pale Ale", degree: 4.5, unitVolume: 375 },
            { name: "James Boag's Premium", degree: 5, unitVolume: 375 },
            { name: "Cascade Premium Lager", degree: 4.5, unitVolume: 375 },
            { name: "Little Creatures Pale Ale", degree: 5.2, unitVolume: 330 },
            { name: "Stone & Wood Pacific Ale", degree: 4.4, unitVolume: 330 },
            { name: "Young Henrys Newtowner", degree: 4.8, unitVolume: 375 },
            { name: "Reschs Dinner Ale", degree: 4.5, unitVolume: 375 },
            { name: "Great Northern Brewing Co.", degree: 4.2, unitVolume: 375 },
            { name: "Fat Yak Pale Ale", degree: 4.7, unitVolume: 345 },
            { name: "Mountain Goat Steam Ale", degree: 4.5, unitVolume: 375 },
            { name: "Balter XPA", degree: 5, unitVolume: 375 },
            { name: "Capital Brewing Co. Trail Pale Ale", degree: 4.7, unitVolume: 375 },
            { name: "Pirate Life IPA", degree: 6.8, unitVolume: 355 },
            { name: "Feral Hop Hog IPA", degree: 5.8, unitVolume: 330 },
            { name: "Gage Roads Single Fin", degree: 4.5, unitVolume: 330 },
            { name: "Matso's Ginger Beer", degree: 3.5, unitVolume: 330 },
            { name: "Brookvale Union Ginger Beer", degree: 4, unitVolume: 330 },
            { name: "Burleigh Brewing Co. Bighead", degree: 4.2, unitVolume: 330 },
            { name: "Green Beacon Wayfarer Tropical Pale Ale", degree: 4.2, unitVolume: 375 },
            { name: "Stone & Wood Green Coast Lager", degree: 4.2, unitVolume: 330 },
            { name: "4 Pines Pale Ale", degree: 5.1, unitVolume: 330 },
            { name: "Two Birds Sunset Ale", degree: 4.6, unitVolume: 330 },
            { name: "Fixation IPA", degree: 6.4, unitVolume: 375 },
            { name: "Colonial Brewing Co. Pale Ale", degree: 4.4, unitVolume: 375 },
            { name: "Pirate Life Port Local", degree: 3.5, unitVolume: 355 },


            // Vins
            { name: "Vin Rouge (Générique)", degree: 12, unitVolume: 125 }, // 12.5cl
            { name: "Vin Blanc Sec (Générique)", degree: 11, unitVolume: 125 },
            { name: "Vin Rosé (Générique)", degree: 12.5, unitVolume: 125 },
            { name: "Champagne/Mousseux", degree: 12, unitVolume: 100 }, // Flûte 10cl
            { name: "Porto Ruby", degree: 20, unitVolume: 60 }, // Dose 6cl
            { name: "Porto Tawny", degree: 20, unitVolume: 60 },
            { name: "Muscat de Rivesaltes", degree: 15, unitVolume: 125 },
            { name: "Bordeaux Rouge", degree: 13, unitVolume: 125 },
            { name: "Chablis", degree: 12.5, unitVolume: 125 },
            { name: "Beaujolais Nouveau", degree: 12, unitVolume: 125 },
            { name: "Sancerre", degree: 13, unitVolume: 125 },
            { name: "Châteauneuf-du-Pape", degree: 14.5, unitVolume: 125 },
            { name: "Prosecco", degree: 11, unitVolume: 125 },
            { name: "Cava", degree: 11.5, unitVolume: 125 },
            { name: "Gewurztraminer", degree: 13.5, unitVolume: 125 },
            { name: "Sauternes", degree: 14, unitVolume: 80 }, // Vin liquoreux
            { name: "Chianti", degree: 13, unitVolume: 125 },
            { name: "Pinot Noir", degree: 13.5, unitVolume: 125 },
            { name: "Merlot", degree: 13.5, unitVolume: 125 },
            { name: "Cabernet Sauvignon", degree: 14, unitVolume: 125 },
            { name: "Chardonnay", degree: 13, unitVolume: 125 },
            { name: "Sauvignon Blanc", degree: 12.5, unitVolume: 125 },
            { name: "Riesling", degree: 10.5, unitVolume: 125 },
            { name: "Malbec", degree: 14, unitVolume: 125 },
            { name: "Syrah/Shiraz", degree: 14.5, unitVolume: 125 },
            { name: "Zinfandel", degree: 14.5, unitVolume: 125 },
            { name: "Grenache", degree: 14, unitVolume: 125 },
            { name: "Tempranillo", degree: 13.5, unitVolume: 125 },
            { name: "Sangiovese", degree: 13, unitVolume: 125 },
            { name: "Chenin Blanc", degree: 12, unitVolume: 125 },
            { name: "Pinot Grigio", degree: 12, unitVolume: 125 },
            { name: "Vermentino", degree: 12.5, unitVolume: 125 },
            { name: "Albariño", degree: 12.5, unitVolume: 125 },
            { name: "Gavi", degree: 12, unitVolume: 125 },
            { name: "Soave", degree: 12, unitVolume: 125 },
            { name: "Valpolicella", degree: 12.5, unitVolume: 125 },
            { name: "Barolo", degree: 14, unitVolume: 125 },
            { name: "Barbaresco", degree: 14, unitVolume: 125 },
            { name: "Amarone", degree: 15, unitVolume: 125 },
            { name: "Brunello di Montalcino", degree: 14.5, unitVolume: 125 },
            { name: "Vino Nobile di Montepulciano", degree: 13.5, unitVolume: 125 },
            { name: "Orvieto", degree: 12, unitVolume: 125 },
            { name: "Frascati", degree: 11.5, unitVolume: 125 },
            { name: "Lambrusco", degree: 8, unitVolume: 125 },
            { name: "Sherry Fino", degree: 15, unitVolume: 60 },
            { name: "Sherry Amontillado", degree: 17, unitVolume: 60 },
            { name: "Sherry Oloroso", degree: 18, unitVolume: 60 },
            { name: "Madeira", degree: 19, unitVolume: 60 },
            { name: "Marsala", degree: 18, unitVolume: 60 },
            { name: "Vermouth Sec", degree: 18, unitVolume: 60 },
            { name: "Vermouth Rouge Doux", degree: 15, unitVolume: 60 },
            { name: "Sake Junmai", degree: 15, unitVolume: 100 },
            { name: "Sake Ginjo", degree: 16, unitVolume: 100 },
            { name: "Sake Daiginjo", degree: 16.5, unitVolume: 100 },
            { name: "Sake Nigori", degree: 14, unitVolume: 100 },

            // Spiritueux (standard: 3cl dose)
            { name: "Vodka (Générique)", degree: 40, unitVolume: 30 },
            { name: "Rhum Blanc (Générique)", degree: 40, unitVolume: 30 },
            { name: "Rhum Ambré (Générique)", degree: 40, unitVolume: 30 },
            { name: "Gin Dry (Générique)", degree: 40, unitVolume: 30 },
            { name: "Gin Floral (Générique)", degree: 42, unitVolume: 30 },
            { name: "Whisky Scotch", degree: 40, unitVolume: 30 },
            { name: "Whisky Bourbon", degree: 43, unitVolume: 30 },
            { name: "Whisky Irlandais", degree: 40, unitVolume: 30 },
            { name: "Tequila Blanco", degree: 40, unitVolume: 30 },
            { name: "Tequila Reposado", degree: 40, unitVolume: 30 },
            { name: "Tequila Añejo", degree: 40, unitVolume: 30 },
            { name: "Cognac VS", degree: 40, unitVolume: 30 },
            { name: "Cognac VSOP", degree: 40, unitVolume: 30 },
            { name: "Cognac XO", degree: 40, unitVolume: 30 },
            { name: "Armagnac", degree: 40, unitVolume: 30 },
            { name: "Calvados", degree: 40, unitVolume: 30 },
            { name: "Pastis (Anisé)", degree: 45, unitVolume: 20 }, // 2cl de pastis pur
            { name: "Ricard", degree: 45, unitVolume: 20 },
            { name: "Jägermeister", degree: 35, unitVolume: 30 },
            { name: "Absinthe", degree: 70, unitVolume: 20 }, // Petite dose
            { name: "Chartreuse Verte", degree: 55, unitVolume: 30 },
            { name: "Chartreuse Jaune", degree: 40, unitVolume: 30 },
            { name: "Get 27", degree: 21, unitVolume: 30 },
            { name: "Malibu", degree: 21, unitVolume: 30 },
            { name: "Baileys Irish Cream", degree: 17, unitVolume: 60 }, // Plus grosse dose
            { name: "Cointreau", degree: 40, unitVolume: 30 },
            { name: "Grand Marnier", degree: 40, unitVolume: 30 },
            { name: "Suze", degree: 15, unitVolume: 60 },
            { name: "Campari", degree: 25, unitVolume: 60 },
            { name: "Aperol", degree: 11, unitVolume: 100 },
            { name: "Ouzo", degree: 40, unitVolume: 30 },
            { name: "Arak", degree: 50, unitVolume: 30 },
            { name: "Schnapps Pêche", degree: 20, unitVolume: 40 },
            { name: "Cachaça", degree: 40, unitVolume: 30 },
            { name: "Mezcal", degree: 40, unitVolume: 30 },
            { name: "Pisco", degree: 40, unitVolume: 30 },
            { name: "Grappa", degree: 40, unitVolume: 30 },
            { name: "Sambuca", degree: 40, unitVolume: 30 },
            { name: "Genepi", degree: 40, unitVolume: 30 },
            { name: "Poire Williams", degree: 43, unitVolume: 30 },
            { name: "Mirabelle", degree: 43, unitVolume: 30 },
            { name: "Kirsch", degree: 40, unitVolume: 30 },
            { name: "Disaronno Amaretto", degree: 28, unitVolume: 40 },
            { name: "Kahlúa", degree: 20, unitVolume: 40 },
            { name: "Tia Maria", degree: 20, unitVolume: 40 },
            { name: "Southern Comfort", degree: 35, unitVolume: 30 },
            { name: "Pernod", degree: 40, unitVolume: 20 },
            { name: "Absolut Vodka", degree: 40, unitVolume: 30 },
            { name: "Grey Goose Vodka", degree: 40, unitVolume: 30 },
            { name: "Bacardi Carta Blanca", degree: 40, unitVolume: 30 },
            { name: "Captain Morgan Spiced Gold", degree: 35, unitVolume: 30 },
            { name: "Bombay Sapphire Gin", degree: 40, unitVolume: 30 },
            { name: "Tanqueray Gin", degree: 43, unitVolume: 30 },
            { name: "Jack Daniel's", degree: 40, unitVolume: 30 },
            { name: "Johnnie Walker Red Label", degree: 40, unitVolume: 30 },
            { name: "Jameson Irish Whiskey", degree: 40, unitVolume: 30 },
            { name: "Patrón Silver Tequila", degree: 40, unitVolume: 30 },
            { name: "Martini Bianco", degree: 15, unitVolume: 100 },
            { name: "Martini Rosso", degree: 15, unitVolume: 100 },
            { name: "Triple Sec", degree: 40, unitVolume: 30 },
            { name: "Crème de Cassis", degree: 15, unitVolume: 40 },
            { name: "Crème de Pêche", degree: 18, unitVolume: 40 },
            { name: "Crème de Framboise", degree: 18, unitVolume: 40 },
            { name: "Crème de Menthe", degree: 25, unitVolume: 40 },
            { name: "Liqueur de Café", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Chocolat", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Coco", degree: 21, unitVolume: 40 },
            { name: "Liqueur d'Amande", degree: 28, unitVolume: 40 },
            { name: "Liqueur de Noisette", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Vanille", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Caramel", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Gingembre", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Piment", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Réglisse", degree: 20, unitVolume: 40 },
            { name: "Liqueur d'Anis", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Verveine", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Sapin", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Miel", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Poire", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Prune", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Fraise", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Myrtille", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Mûre", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Cerise", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Banane", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Melon", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Pomme", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Pistache", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Noix", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Châtaigne", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Coing", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Mandarine", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Pamplemousse", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Citron", degree: 20, unitVolume: 40 },
            { name: "Liqueur d'Orange", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Fleur de Sureau", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Rose", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Violette", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Lavande", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Thym", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Romarin", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Basilic", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Cannelle", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Cardamome", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Clou de Girofle", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Noix de Muscade", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Poivre", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Piment d'Espelette", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Fève Tonka", degree: 20, unitVolume: 40 },
            { name: "Liqueur de Gentiane", degree: 20, unitVolume: 40 },

            // Cocktails et mélanges populaires (estimations)
            { name: "Jagerbomb", degree: 10, unitVolume: 150 }, // 3cl Jager + 12cl Redbull (estimation)
            { name: "Vodka Orange", degree: 8, unitVolume: 250 }, // 4cl Vodka + 21cl Jus d'orange (estimation)
            { name: "Vodka Redbull", degree: 10, unitVolume: 250 }, // 4cl Vodka + 21cl Redbull (estimation)
            { name: "Rhum Coca", degree: 8, unitVolume: 250 }, // 4cl Rhum + 21cl Coca (estimation)
            { name: "Gin Tonic", degree: 10, unitVolume: 200 }, // 4cl Gin + 16cl Tonic (estimation)
            { name: "Mojito", degree: 15, unitVolume: 200 }, // Est. pour un cocktail de 20cl
            { name: "Margarita", degree: 18, unitVolume: 150 },
            { name: "Cosmopolitan", degree: 18, unitVolume: 150 },
            { name: "Cuba Libre", degree: 10, unitVolume: 250 },
            { name: "Bloody Mary", degree: 8, unitVolume: 250 },
            { name: "Caipirinha", degree: 20, unitVolume: 150 },
            { name: "Pina Colada", degree: 10, unitVolume: 250 },
            { name: "Sex on the Beach", degree: 10, unitVolume: 250 },
            { name: "Long Island Iced Tea", degree: 22, unitVolume: 300 }, // Plus fort et plus grand
            { name: "Old Fashioned", degree: 30, unitVolume: 100 },
            { name: "Manhattan", degree: 30, unitVolume: 100 },
            { name: "Gin Fizz", degree: 12, unitVolume: 200 },
            { name: "Whisky Coca", degree: 8, unitVolume: 250 },
            { name: "Tequila Sunrise", degree: 10, unitVolume: 250 },
            { name: "Spritz", degree: 8, unitVolume: 200 },
            { name: "Kir Royal", degree: 12, unitVolume: 125 },
            { name: "Ti Punch", degree: 30, unitVolume: 60 }, // Petit mais fort
            { name: "Américano", degree: 15, unitVolume: 150 },
            { name: "Moscow Mule", degree: 8, unitVolume: 250 },
            { name: "Dark 'n' Stormy", degree: 8, unitVolume: 250 },
            { name: "Bloody Caesar", degree: 8, unitVolume: 300 },
            { name: "White Russian", degree: 20, unitVolume: 150 },
            { name: "Black Russian", degree: 25, unitVolume: 100 },
            { name: "Espresso Martini", degree: 20, unitVolume: 100 },
            { name: "Pornstar Martini", degree: 15, unitVolume: 150 },
            { name: "Daiquiri", degree: 18, unitVolume: 100 },
            { name: "Mojito Framboise", degree: 15, unitVolume: 200 },
            { name: "Blue Lagoon", degree: 8, unitVolume: 250 },
            { name: "Tom Collins", degree: 12, unitVolume: 250 },
            { name: "French 75", degree: 15, unitVolume: 150 },
            { name: "Sidecar", degree: 25, unitVolume: 80 },
            { name: "Whisky Sour", degree: 20, unitVolume: 120 },
            { name: "Negroni", degree: 25, unitVolume: 90 },
            { name: "Boulevardier", degree: 25, unitVolume: 90 },
            { name: "Sazerac", degree: 35, unitVolume: 80 },
            { name: "Mint Julep", degree: 25, unitVolume: 200 },
            { name: "Adios Motherfucker", degree: 20, unitVolume: 300 },
            { name: "B52 (Shot)", degree: 25, unitVolume: 45 }, 
            { name: "Irish Coffee", degree: 15, unitVolume: 200 },
            { name: "Hot Toddy", degree: 10, unitVolume: 200 },
            { name: "Grog", degree: 15, unitVolume: 200 },
            { name: "Vin chaud", degree: 10, unitVolume: 200 },
            { name: "Sangria", degree: 8, unitVolume: 200 },
            { name: "Punch", degree: 15, unitVolume: 200 },
            { name: "Caipiroska", degree: 15, unitVolume: 150 },
            { name: "Mule de Paris", degree: 8, unitVolume: 250 },
            { name: "Bellini", degree: 10, unitVolume: 150 },
            { name: "Mimosa", degree: 10, unitVolume: 150 },
            { name: "Michelada", degree: 5, unitVolume: 330 },
            { name: "Shandy", degree: 2.5, unitVolume: 330 },
            { name: "Panaché", degree: 1, unitVolume: 330 },
            { name: "Hard Seltzer (Générique)", degree: 5, unitVolume: 330 },
            { name: "Cidre Doux", degree: 2, unitVolume: 250 },
            { name: "Cidre Brut", degree: 4, unitVolume: 250 },
            { name: "Cidre Rosé", degree: 3, unitVolume: 250 },
            { name: "Cidre Poire", degree: 2.5, unitVolume: 250 },
            { name: "Pimm's Cup", degree: 5, unitVolume: 250 },
            { name: "Floc de Gascogne", degree: 16, unitVolume: 125 },
            { name: "Pineau des Charentes", degree: 17, unitVolume: 125 },
            { name: "Hypocras", degree: 13, unitVolume: 125 },
            { name: "Chouchen", degree: 14, unitVolume: 125 },
            { name: "Hydromel", degree: 12, unitVolume: 125 },
            { name: "Pastis sans alcool", degree: 0, unitVolume: 200 }, 
            { name: "Bière sans alcool", degree: 0.5, unitVolume: 250 }, 
            { name: "Vin sans alcool", degree: 0.5, unitVolume: 125 }, 
        ];

        // Deduplicate alcohol data
        const alcoholMap = new Map();
        rawAlcoolData.forEach(item => {
            const key = `${item.name}-${item.degree}-${item.unitVolume}`;
            if (!alcoholMap.has(key)) {
                alcoholMap.set(key, item);
            }
        });
        const alcoolData = Array.from(alcoholMap.values());


        const substances = {
            alcool: alcoolData, // Use the deduplicated and expanded list
            drogue: [
                { name: "Cannabis (joint/inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Cannabis :</strong></p>
                    <ul>
                        <li>Commencez par de petites quantités et attendez de voir les effets avant de consommer plus.</li>
                        <li>Utilisez des méthodes de consommation moins nocives si possible (vaporisation plutôt que combustion).</li>
                        <li>Si vous ressentez de l'anxiété ou de la paranoïa, essayez de vous calmer dans un environnement sûr.</li>
                        <li>Connaissez vos limites et ne vous forcez pas à consommer si vous ne vous sentez pas bien.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Cannabis :</strong></p>
                    <ul>
                        <li>Dépendance psychologique.</li>
                        <li>Problèmes respiratoires (si fumé).</li>
                        <li>Augmentation de l'anxiété, de la paranoïa, et risque de troubles psychotiques chez les personnes vulnérables.</li>
                        <li>Altération des capacités cognitives et de la mémoire.</li>
                        <li>Ne conduisez jamais sous l'influence du cannabis.</li>
                        <li>Évitez de mélanger avec l'alcool ou d'autres drogues, cela peut augmenter les risques.</li>
                        <li>La consommation régulière peut entraîner des problèmes de santé mentale.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Cocaïne (ligne/prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Cocaïne :</strong></p>
                    <ul>
                        <li>La cocaïne est une substance très addictive et dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous consommez, ne partagez pas le matériel d'injection ou d'inhalation pour éviter les infections (hépatites, VIH).</li>
                        <li>Ne consommez jamais seul. Assurez-vous d'être avec des personnes de confiance.</li>
                        <li>Hydratez-vous régulièrement, mais évitez l'alcool.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Cocaïne :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique très rapide et intense.</li>
                        <li>Risque élevé de surdose (crise cardiaque, AVC, convulsions).</li>
                        <li>Problèmes cardiovasculaires (hypertension, arythmies).</li>
                        <li>Anxiété, paranoïa, psychose.</li>
                        <li>Dommages aux voies nasales (si sniffée).</li>
                        <li>Ne conduisez jamais sous l'influence de la cocaïne.</li>
                        <li>Évitez de mélanger avec l'alcool ou d'autres dépresseurs, cela augmente considérablement le risque de surdose mortelle.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "MDMA/Ecstasy (comprimé/gélule)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la MDMA/Ecstasy :</strong></p>
                    <ul>
                        <li>Testez toujours vos produits si possible, car la composition des comprimés peut varier et contenir des substances dangereuses.</li>
                        <li>Commencez par une faible dose (la moitié d'un comprimé) et attendez au moins 1h30 avant de redoser.</li>
                        <li>Hydratez-vous régulièrement avec de l'eau (environ 1 verre par heure), mais ne buvez pas excessivement pour éviter l'hyponatrémie.</li>
                        <li>Faites des pauses régulières dans des endroits frais si vous dansez ou êtes dans un environnement chaud.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la MDMA/Ecstasy :</strong></p>
                    <ul>
                        <li>Hyperthermie (coup de chaleur), déshydratation ou hyponatrémie (excès d'eau).</li>
                        <li>Problèmes cardiaques (arythmies, hypertension).</li>
                        <li>Neurotoxicité à long terme (dommages aux neurones sérotoninergiques).</li>
                        <li>Dépression et anxiété ("descente") dans les jours suivant la prise.</li>
                        <li>Ne conduisez jamais sous l'influence de la MDMA.</li>
                        <li>Évitez de mélanger avec l'alcool ou d'autres stimulants.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Amphétamines/Speed (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour les Amphétamines/Speed :</strong></p>
                    <ul>
                        <li>Commencez par une petite quantité pour évaluer votre réaction.</li>
                        <li>Hydratez-vous bien et mangez des repas légers et nutritifs, même si votre appétit est réduit.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés aux Amphétamines/Speed :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique.</li>
                        <li>Risque de surdose (crises cardiaques, AVC, psychoses).</li>
                        <li>Problèmes cardiovasculaires, hypertension.</li>
                        <li>Anxiété, paranoïa, insomnie, épuisement.</li>
                        <li>Ne conduisez jamais sous l'influence des amphétamines.</li>
                        <li>Évitez de mélanger avec d'autres stimulants ou dépresseurs (alcool, opioïdes), cela augmente les risques.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Kétamine (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Kétamine :</strong></p>
                    <ul>
                        <li>Les doses doivent être très faibles.</li>
                        <li>Consommez dans un environnement sûr et calme, de préférence assis ou allongé, car la coordination peut être fortement altérée.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Kétamine :</strong></p>
                    <ul>
                        <li>Risque de dépression respiratoire et de coma, surtout en cas de mélange.</li>
                        <li>Problèmes urinaires graves (cystite de la kétamine) en cas de consommation régulière.</li>
                        <li>Désorientation, hallucinations, anxiété intense.</li>
                        <li>Ne conduisez jamais sous l'influence de la kétamine.</li>
                        <li>Ne mélangez jamais avec de l'alcool, des benzodiazépines ou d'autres dépresseurs.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "LSD (buvard/goutte)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le LSD :</strong></p>
                    <ul>
                        <li>Préparez un "set and setting" approprié : un environnement sûr, calme et avec des personnes de confiance.</li>
                        <li>Commencez par une très petite dose, surtout si c'est votre première fois.</li>
                        <li>Assurez-vous d'être dans un bon état d'esprit avant de consommer. Évitez si vous êtes anxieux, déprimé ou stressé.</li>
                        <li>Ayez un "trip-sitter" sobre et expérimenté à vos côtés.</li>
                        <li>Si le "trip" devient difficile, essayez de vous calmer, changez d'environnement, écoutez de la musique apaisante. Rappelez-vous que les effets sont temporaires.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au LSD :</strong></p>
                    <ul>
                        <li>"Bad trip" (crise d'angoisse, paranoïa, psychose temporaire).</li>
                        <li>Flashbacks (réminiscences des effets sans nouvelle prise).</li>
                        <li>Déclenchement ou aggravation de troubles psychotiques latents.</li>
                        <li>Ne conduisez jamais sous l'influence du LSD.</li>
                        <li>Ne mélangez pas avec d'autres substances, en particulier d'autres psychédéliques ou stimulants.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: false
                }, 
                { name: "Champignons hallucinogènes (portion)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour les Champignons Hallucinogènes :</strong></p>
                    <ul>
                        <li>Identifiez correctement les champignons. Ne consommez jamais de champignons sauvages sans une expertise mycologique confirmée.</li>
                        <li>Commencez par une petite portion pour évaluer la puissance et vos réactions.</li>
                        <li>Prévoyez un environnement sûr et calme, avec un "trip-sitter" si possible.</li>
                        <li>Les effets peuvent durer plusieurs heures. Assurez-vous d'avoir suffisamment de temps et un endroit pour vous reposer.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés aux Champignons Hallucinogènes :</strong></p>
                    <ul>
                        <li>Intoxication grave voire mortelle si l'identification est incorrecte.</li>
                        <li>"Bad trip" (crise d'angoisse, paranoïa, psychose temporaire).</li>
                        <li>Nausées, vomissements, maux d'estomac.</li>
                        <li>Ne conduisez jamais sous l'influence des champignons.</li>
                        <li>Ne mélangez pas avec d'autres substances.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: false
                }, 
                { name: "GHB/GBL (dose)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le GHB/GBL :</strong></p>
                    <ul>
                        <li>Utilisez une seringue graduée pour mesurer la dose avec une extrême précision. Ne buvez jamais directement à la bouteille.</li>
                        <li>Attendez au moins 2 à 3 heures entre les doses, car les effets peuvent être retardés.</li>
                        <li>Ne consommez jamais seul. Assurez-vous d'être avec des personnes de confiance qui savent quoi faire en cas de surdose.</li>
                        <li>Si quelqu'un perd connaissance, mettez-le en position latérale de sécurité et appelez immédiatement les secours.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au GHB/GBL :</strong></p>
                    <ul>
                        <li>Risque de surdose extrêmement élevé (coma, dépression respiratoire, mort) en raison de la faible marge de sécurité.</li>
                        <li>Dépendance physique et psychologique sévère, sevrage dangereux.</li>
                        <li>Perte de conscience, amnésie.</li>
                        <li>Ne mélangez JAMAIS avec de l'alcool ou d'autres dépresseurs (benzodiazépines, opioïdes).</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Poppers (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour les Poppers :</strong></p>
                    <ul>
                        <li>Inhalez-les uniquement par le nez, en petites quantités.</li>
                        <li>Utilisez dans un endroit bien ventilé.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés aux Poppers :</strong></p>
                    <ul>
                        <li>Extrêmement toxiques par voie orale (ne jamais ingérer).</li>
                        <li>Chute de tension artérielle dangereuse, surtout avec des médicaments pour la dysfonction érectile.</li>
                        <li>Maux de tête, nausées, vertiges.</li>
                        <li>Dommages aux poumons et aux yeux en cas d'utilisation excessive.</li>
                        <li>Ne mélangez pas avec d'autres drogues ou l'alcool.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Héroïne (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour l'Héroïne :</strong></p>
                    <ul>
                        <li>L'héroïne est un opioïde très puissant et extrêmement dangereux. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous consommez, ne partagez jamais le matériel d'injection (utilisez toujours du matériel stérile).</li>
                        <li>Commencez par une très petite dose, surtout si vous n'êtes pas sûr de la pureté ou si vous avez fait une pause.</li>
                        <li>Ne consommez jamais seul. Ayez toujours quelqu'un avec vous qui peut intervenir en cas de surdose et qui a accès à de la naloxone (Narcan).</li>
                        <li>Si vous voyez quelqu'un en surdose, appelez immédiatement les secours et administrez de la naloxone si disponible.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à l'Héroïne :</strong></p>
                    <ul>
                        <li>Risque de surdose mortelle très élevé (dépression respiratoire).</li>
                        <li>Dépendance physique et psychologique très rapide et intense.</li>
                        <li>Transmission de maladies infectieuses (VIH, hépatites) par le partage de matériel.</li>
                        <li>Problèmes veineux, abcès, infections.</li>
                        <li>Ne mélangez JAMAIS avec l'alcool, les benzodiazépines ou d'autres dépresseurs.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Crack (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Crack :</strong></p>
                    <ul>
                        <li>Le crack est une forme de cocaïne très addictive et destructrice. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous consommez, ne partagez pas les pipes pour éviter la transmission de maladies et les brûlures.</li>
                        <li>Hydratez-vous et essayez de manger, même si l'appétit est réduit.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Crack :</strong></p>
                    <ul>
                        <li>Dépendance très rapide et intense.</li>
                        <li>Risque élevé de surdose (crise cardiaque, AVC, convulsions).</li>
                        <li>Paranoïa intense, psychose, comportements agressifs.</li>
                        <li>Problèmes respiratoires et pulmonaires (si fumé).</li>
                        <li>Ne mélangez pas avec l'alcool ou d'autres substances.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Solvants (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour les Solvants :</strong></p>
                    <ul>
                        <li>La consommation de solvants est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous êtes dépendant, cherchez de l'aide médicale ou auprès d'associations spécialisées.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés aux Solvants :</strong></p>
                    <ul>
                        <li>Mort subite par arrêt cardiaque ("sudden sniffing death syndrome").</li>
                        <li>Dommages irréversibles au cerveau, au cœur, aux reins et au foie.</li>
                        <li>Asphyxie, convulsions, coma.</li>
                        <li>Effets imprévisibles : hallucinations, vertiges, nausées.</li>
                        <li>Évitez tout contact avec la peau et les yeux.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Médicament détourné - Opioïde (comprimé/dose)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour les Opioïdes détournés :</strong></p>
                    <ul>
                        <li>Ne les utilisez que sous prescription médicale.</li>
                        <li>Commencez par la dose la plus faible possible, surtout si vous n'avez pas de tolérance.</li>
                        <li>Ne consommez jamais seul. Ayez quelqu'un avec vous qui peut intervenir en cas de surdose et qui a accès à de la naloxone.</li>
                        <li>Si vous voyez quelqu'un en surdose, appelez immédiatement les secours et administrez de la naloxone si disponible.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés aux Opioïdes détournés :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique sévère.</li>
                        <li>Risque élevé de surdose mortelle (dépression respiratoire).</li>
                        <li>Constipation sévère, nausées, vomissements.</li>
                        <li>Ne mélangez jamais avec de l'alcool, des benzodiazépines ou d'autres dépresseurs du système nerveux central.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Médicament détourné - Benzodiazépine (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour les Benzodiazépines détournées :</strong></p>
                    <ul>
                        <li>Ne les utilisez que sous prescription médicale.</li>
                        <li>Commencez par la dose la plus faible et ne dépassez jamais la dose recommandée.</li>
                        <li>Si vous êtes dépendant, parlez-en à un professionnel de la santé pour un plan de sevrage sécurisé.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés aux Benzodiazépines détournées :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique rapide.</li>
                        <li>Risque de dépression respiratoire sévère, coma et mort, surtout en mélange avec d'autres dépresseurs.</li>
                        <li>Altération de la vigilance, de la coordination et de la mémoire.</li>
                        <li>Sevrage dangereux (convulsions, délire) s'il n'est pas supervisé médicalement.</li>
                        <li>Ne mélangez JAMAIS avec de l'alcool, des opioïdes ou d'autres dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence des benzodiazépines.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Tabac (cigarette/unité)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Tabac :</strong></p>
                    <ul>
                        <li>La meilleure option est de ne pas fumer.</li>
                        <li>Si vous fumez, réduire votre consommation est un premier pas.</li>
                        <li>De nombreuses aides existent pour arrêter de fumer (substituts nicotiniques, thérapies comportementales, applications).</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Tabac :</strong></p>
                    <ul>
                        <li>Dépendance à la nicotine.</li>
                        <li>Nombreuses maladies graves : cancers (poumon, gorge, bouche, etc.), maladies cardiovasculaires (infarctus, AVC), maladies respiratoires (BPCO, emphysème).</li>
                        <li>Tabagisme passif pour l'entourage.</li>
                        <li>Chaque cigarette fumée est une exposition à des milliers de substances chimiques nocives.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: false
                },
                { name: "Protoxyde d'azote (cartouche/ballon)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Protoxyde d'Azote :</strong></p>
                    <ul>
                        <li>N'inhalez jamais directement de la cartouche ou de la bonbonne (risque de gelures). Utilisez toujours un ballon.</li>
                        <li>Consommez dans un endroit bien ventilé pour éviter l'asphyxie.</li>
                        <li>Évitez de consommer debout pour prévenir les chutes.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Protoxyde d'Azote :</strong></p>
                    <ul>
                        <li>Gelures graves aux voies respiratoires et aux poumons si inhalé directement.</li>
                        <li>Asphyxie par manque d'oxygène.</li>
                        <li>Carence en vitamine B12, pouvant entraîner des dommages neurologiques graves et irréversibles (en cas d'utilisation fréquente/excessive).</li>
                        <li>Maux de tête, vertiges, nausées, perte de conscience.</li>
                        <li>Ne mélangez pas avec l'alcool ou d'autres drogues.</li>
                        <li>Ne conduisez jamais sous l'influence du protoxyde d'azote.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Sels de bain / Cathinones (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour les Sels de Bain / Cathinones :</strong></p>
                    <ul>
                        <li>La consommation de "sels de bain" est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous en consommez, sachez que la composition est inconnue et les effets imprévisibles.</li>
                        <li>Si vous ou quelqu'un d'autre présente des symptômes graves, appelez immédiatement les secours.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés aux Sels de Bain / Cathinones :</strong></p>
                    <ul>
                        <li>Extrêmement dangereux et imprévisibles, risque de mort.</li>
                        <li>Agitation extrême, paranoïa, hallucinations, psychose.</li>
                        <li>Crises cardiaques, accidents vasculaires cérébraux, hyperthermie mortelle.</li>
                        <li>Dépendance très rapide et problèmes de santé mentale à long terme.</li>
                        <li>Ne mélangez jamais avec d'autres substances.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Spice / Cannabinoïdes de synthèse (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Spice / Cannabinoïdes de Synthèse :</strong></p>
                    <ul>
                        <li>La consommation de ces substances est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous en consommez, commencez par une quantité minuscule, car la puissance peut être extrêmement élevée et imprévisible.</li>
                        <li>Si vous ou quelqu'un d'autre présente des symptômes graves, appelez immédiatement les secours.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Spice / Cannabinoïdes de Synthèse :</strong></p>
                    <ul>
                        <li>Effets imprévus et graves : crises d'anxiété, psychoses, convulsions, insuffisance rénale aiguë, crises cardiaques.</li>
                        <li>Dépendance rapide et sevrage très difficile.</li>
                        <li>Composition très variable et inconnue, rendant le dosage et les effets imprévisibles.</li>
                        <li>Ne mélangez pas avec d'autres substances.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "DMT (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le DMT :</strong></p>
                    <ul>
                        <li>Préparez un "set and setting" très sûr et calme. Idéalement, ayez un guide sobre et expérimenté.</li>
                        <li>Les effets sont immédiats et peuvent être écrasants. Ne consommez pas si vous êtes anxieux ou dans un mauvais état d'esprit.</li>
                        <li>Assurez-vous d'être dans une position confortable et sécurisée.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au DMT :</strong></p>
                    <ul>
                        <li>Expérience psychédélique intense et parfois effrayante ("bad trip").</li>
                        <li>Désorientation sévère et perte de contrôle corporel.</li>
                        <li>Peut déclencher ou aggraver des troubles psychotiques.</li>
                        <li>Ne mélangez pas avec d'autres substances, en particulier d'autres psychédéliques ou antidépresseurs (IMAO).</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: false
                },
                { name: "Psilocybine (portion)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Psilocybine (Champignons Magiques) :</strong></p>
                    <ul>
                        <li>Identifiez avec certitude les champignons (risque de confusion avec des espèces toxiques).</li>
                        <li>Commencez par une faible dose, surtout si c'est votre première fois.</li>
                        <li>Prévoyez un environnement sûr et calme, avec un "trip-sitter" si possible.</li>
                        <li>Si le "trip" devient difficile, rappelez-vous que c'est temporaire.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Psilocybine :</strong></p>
                    <ul>
                        <li>Intoxication grave voire mortelle si l'identification est incorrecte.</li>
                        <li>"Bad trip" (crise d'angoisse, paranoïa, psychose temporaire).</li>
                        <li>Nausées, vomissements, maux d'estomac.</li>
                        <li>Ne conduisez jamais sous l'influence de la psilocybine.</li>
                        <li>Ne mélangez pas avec d'autres substances.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: false
                },
                { name: "Mescaline (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Mescaline :</strong></p>
                    <ul>
                        <li>Préparez-vous à une expérience prolongée (effets longs).</li>
                        <li>Commencez par une faible dose pour évaluer votre sensibilité.</li>
                        <li>Assurez-vous d'être dans un environnement sûr et d'avoir des personnes de confiance autour de vous.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Mescaline :</strong></p>
                    <ul>
                        <li>Nausées et vomissements intenses au début de l'expérience.</li>
                        <li>"Bad trip" (anxiété, confusion, psychose temporaire).</li>
                        <li>Peut déclencher ou aggraver des troubles psychotiques.</li>
                        <li>Ne conduisez jamais sous l'influence de la mescaline.</li>
                        <li>Ne mélangez pas avec d'autres substances.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: false
                },
                { name: "Salvia Divinorum (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Salvia Divinorum :</strong></p>
                    <ul>
                        <li>Consommez dans un environnement sûr et calme, de préférence assis ou allongé, avec une personne sobre présente.</li>
                        <li>Commencez par une dose minuscule, car la puissance varie énormément.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Salvia Divinorum :</strong></p>
                    <ul>
                        <li>Effets très intenses, désorientants et parfois effrayants.</li>
                        <li>Perte de contrôle corporel, risque de chute et de blessure.</li>
                        <li>Peut déclencher ou aggraver des troubles psychotiques.</li>
                        <li>Ne mélangez pas avec d'autres substances, en particulier des dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence de la Salvia.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Kratom (dose)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Kratom :</strong></p>
                    <ul>
                        <li>Commencez par une faible dose. Les effets peuvent varier considérablement.</li>
                        <li>Si vous développez une dépendance, cherchez de l'aide professionnelle.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Kratom :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique.</li>
                        <li>Symptômes de sevrage désagréables.</li>
                        <li>Nausées, constipation, vertiges, léthargie.</li>
                        <li>Risque de dépression respiratoire en cas de mélange avec d'autres dépresseurs.</li>
                        <li>Ne mélangez pas avec l'alcool, les benzodiazépines ou d'autres dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence du Kratom.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Tramadol (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Tramadol :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Ne dépassez jamais la dose prescrite.</li>
                        <li>Si vous ou quelqu'un d'autre présente des signes de surdose, appelez immédiatement les secours.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Tramadol :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique.</li>
                        <li>Risque de surdose (convulsions, dépression respiratoire, mort).</li>
                        <li>Syndrome sérotoninergique si mélangé avec certains antidépresseurs.</li>
                        <li>Nausées, vertiges, somnolence.</li>
                        <li>Ne mélangez jamais avec de l'alcool, des benzodiazépines, des antidépresseurs ou d'autres opioïdes.</li>
                        <li>Ne conduisez jamais sous l'influence du Tramadol.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Fentanyl (dose)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Fentanyl :</strong></p>
                    <ul>
                        <li>Le Fentanyl est extrêmement dangereux. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous consommez, ne le faites jamais seul.</li>
                        <li>Ayez toujours de la naloxone (Narcan) à portée de main et sachez l'utiliser.</li>
                        <li>Si vous voyez quelqu'un en surdose, appelez immédiatement les secours et administrez de la naloxone si disponible.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Fentanyl :</strong></p>
                    <ul>
                        <li>Risque de surdose mortelle extrêmement élevé (dépression respiratoire).</li>
                        <li>Extrêmement puissant, même une dose minuscule peut être fatale.</li>
                        <li>Dépendance physique et psychologique très rapide.</li>
                        <li>Souvent présent dans d'autres drogues sans le savoir.</li>
                        <li>Ne mélangez JAMAIS avec d'autres substances (alcool, benzodiazépines, autres opioïdes).</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Subutex (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Subutex :</strong></p>
                    <ul>
                        <li>Doit être utilisé uniquement sous prescription et suivi médical strict.</li>
                        <li>Respectez scrupuleusement la posologie et les instructions de votre médecin.</li>
                        <li>Ne partagez pas votre traitement.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Subutex :</strong></p>
                    <ul>
                        <li>Risque de dépression respiratoire et de mort si mélangé avec de l'alcool ou des benzodiazépines.</li>
                        <li>Peut entraîner une dépendance s'il est détourné.</li>
                        <li>Ne l'utilisez jamais à des fins récréatives.</li>
                        <li>Ne mélangez JAMAIS avec de l'alcool, des benzodiazépines ou d'autres dépresseurs.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Méthadone (dose)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Méthadone :</strong></p>
                    <ul>
                        <li>Doit être utilisée uniquement sous prescription et suivi médical strict.</li>
                        <li>Respectez scrupuleusement la posologie et les instructions de votre médecin/centre.</li>
                        <li>Ne partagez pas votre traitement.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Méthadone :</strong></p>
                    <ul>
                        <li>Risque de dépression respiratoire et de mort si mélangée avec de l'alcool ou des benzodiazépines.</li>
                        <li>Peut être fatale en surdose, surtout pour les personnes n'ayant pas de tolérance.</li>
                        <li>Ne l'utilisez jamais à des fins récréatives.</li>
                        <li>Ne mélangez JAMAIS avec de l'alcool, des benzodiazépines ou d'autres dépresseurs.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Rivotril (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Rivotril :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Respectez la dose prescrite.</li>
                        <li>Le sevrage doit être supervisé par un médecin.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Rivotril :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique rapide.</li>
                        <li>Risque de dépression respiratoire sévère, coma et mort, surtout en mélange avec d'autres dépresseurs.</li>
                        <li>Altération de la vigilance et de la coordination.</li>
                        <li>Ne mélangez JAMAIS avec de l'alcool, des opioïdes ou d'autres dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence du Rivotril.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Xanax (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Xanax :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Respectez la dose prescrite.</li>
                        <li>Le sevrage doit être supervisé par un médecin.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Xanax :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique rapide.</li>
                        <li>Risque de dépression respiratoire sévère, coma et mort, surtout en mélange avec d'autres dépresseurs.</li>
                        <li>Altération de la vigilance et de la coordination.</li>
                        <li>Ne mélangez JAMAIS avec de l'alcool, des opioïdes ou d'autres dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence du Xanax.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Valium (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Valium :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Respectez la dose prescrite.</li>
                        <li>Le sevrage doit être supervisé par un médecin.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Valium :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique rapide.</li>
                        <li>Risque de dépression respiratoire sévère, coma et mort, surtout en mélange avec d'autres dépresseurs.</li>
                        <li>Altération de la vigilance et de la coordination.</li>
                        <li>Ne mélangez JAMAIS avec de l'alcool, des opioïdes ou d'autres dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence du Valium.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Lyrica (gélule)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Lyrica :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Respectez la dose prescrite.</li>
                        <li>Le sevrage doit être progressif sous supervision médicale.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Lyrica :</strong></p>
                    <ul>
                        <li>Dépendance et risque de détournement.</li>
                        <li>Sédation excessive, vertiges, somnolence.</li>
                        <li>Risque de dépression respiratoire et de surdose en cas de mélange avec l'alcool, les opioïdes ou les benzodiazépines.</li>
                        <li>Ne conduisez jamais sous l'influence du Lyrica.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Gabapentine (gélule)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Gabapentine :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Respectez la dose prescrite.</li>
                        <li>Le sevrage doit être progressif sous supervision médicale.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Gabapentine :</strong></p>
                    <ul>
                        <li>Dépendance et risque de détournement.</li>
                        <li>Sédation excessive, vertiges, somnolence.</li>
                        <li>Risque de dépression respiratoire en cas de mélange avec l'alcool, les opioïdes ou les benzodiazépines.</li>
                        <li>Ne conduisez jamais sous l'influence de la Gabapentine.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Adderall (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour l'Adderall :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Respectez la dose prescrite.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à l'Adderall :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique.</li>
                        <li>Risques cardiaques (crises cardiaques, arythmies), accidents vasculaires cérébraux, convulsions, psychoses.</li>
                        <li>Anxiété, insomnie, perte d'appétit.</li>
                        <li>Ne mélangez pas avec d'autres stimulants ou dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence de l'Adderall si vous en abusez.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Ritaline (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Ritaline :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Respectez la dose prescrite.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Ritaline :</strong></p>
                    <ul>
                        <li>Dépendance physique et psychologique.</li>
                        <li>Risques cardiaques (crises cardiaques, arythmies), accidents vasculaires cérébraux, convulsions, psychoses.</li>
                        <li>Anxiété, insomnie, perte d'appétit.</li>
                        <li>Ne mélangez pas avec d'autres stimulants ou dépresseurs.</li>
                        <li>Ne conduisez jamais sous l'influence de la Ritaline si vous en abusez.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Modafinil (comprimé)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Modafinil :</strong></p>
                    <ul>
                        <li>Ne l'utilisez que sous prescription médicale.</li>
                        <li>Ne conduisez pas si vous ressentez des effets secondaires qui altèrent votre vigilance.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Modafinil :</strong></p>
                    <ul>
                        <li>Dépendance psychologique possible.</li>
                        <li>Insomnie, anxiété, maux de tête.</li>
                        <li>Réactions cutanées graves (rares).</li>
                        <li>Ne mélangez pas avec d'autres stimulants.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Dextrométhorphane (DXM) (dose)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Dextrométhorphane (DXM) :</strong></p>
                    <ul>
                        <li>Ne consommez jamais de sirops ou comprimés contenant d'autres principes actifs (paracétamol, antihistaminiques, décongestionnants).</li>
                        <li>Commencez par une très petite dose pour évaluer les effets.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Dextrométhorphane (DXM) :</strong></p>
                    <ul>
                        <li>À fortes doses, effets dissociatifs et hallucinogènes.</li>
                        <li>Risque de surdose et de dépression respiratoire, surtout en mélange avec l'alcool ou d'autres dépresseurs.</li>
                        <li>Syndrome sérotoninergique potentiellement mortel si mélangé avec antidépresseurs (IMAO/ISRS).</li>
                        <li>Nausées, vomissements, vertiges.</li>
                        <li>Ne conduisez jamais sous l'influence du DXM.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Datura (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Datura :</strong></p>
                    <ul>
                        <li>La consommation de Datura est extrêmement dangereuse et fortement déconseillée. Il n'y a pas de "bonne" façon de le prendre.</li>
                        <li>En cas d'ingestion, cherchez une aide médicale d'urgence immédiate.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Datura :</strong></p>
                    <ul>
                        <li>Extrêmement toxique et dangereux, risque de mort.</li>
                        <li>Hallucinations délirantes intenses, perte de contact avec la réalité.</li>
                        <li>Effets physiques graves : tachycardie, hyperthermie, convulsions, coma.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Belladone (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Belladone :</strong></p>
                    <ul>
                        <li>La consommation de Belladone est extrêmement dangereuse et fortement déconseillée. Il n'y a pas de "bonne" façon de le prendre.</li>
                        <li>En cas d'ingestion, cherchez une aide médicale d'urgence immédiate.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Belladone :</strong></p>
                    <ul>
                        <li>Très toxique, risque de mort même à faibles doses.</li>
                        <li>Hallucinations délirantes, perte de réalité.</li>
                        <li>Effets physiques graves : tachycardie, hyperthermie, convulsions, coma.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Noix de muscade (prise)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Noix de Muscade :</strong></p>
                    <ul>
                        <li>La consommation à des fins récréatives est déconseillée en raison des effets secondaires désagréables et potentiellement dangereux.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Noix de Muscade :</strong></p>
                    <ul>
                        <li>À fortes doses : effets hallucinogènes imprévisibles et très longs (jusqu'à 24-48h).</li>
                        <li>Nausées, vomissements, palpitations, confusion, déshydratation sévère.</li>
                        <li>Ne mélangez pas avec d'autres substances.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Colle (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Colle (Inhalation) :</strong></p>
                    <ul>
                        <li>L'inhalation de colle est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous êtes dépendant, cherchez de l'aide médicale.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Colle (Inhalation) :</strong></p>
                    <ul>
                        <li>Mort subite par arrêt cardiaque.</li>
                        <li>Dommages irréversibles au cerveau, au cœur, aux reins et au foie.</li>
                        <li>Asphyxie, convulsions, coma.</li>
                        <li>Effets imprévisibles : hallucinations, vertiges, nausées.</li>
                        <li>Évitez tout contact avec la peau et les yeux.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Gaz briquet (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Gaz Briquet (Inhalation) :</strong></p>
                    <ul>
                        <li>L'inhalation de gaz briquet est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous êtes dépendant, cherchez de l'aide médicale.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Gaz Briquet (Inhalation) :</strong></p>
                    <ul>
                        <li>Mort subite par arrêt cardiaque ("sudden sniffing death syndrome") très élevé.</li>
                        <li>Dommages irréversibles au cerveau, au cœur, aux reins et au foie.</li>
                        <li>Asphyxie, convulsions, coma.</li>
                        <li>Effets imprévisibles : hallucinations, vertiges, nausées.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Peinture en aérosol (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour la Peinture en Aérosol (Inhalation) :</strong></p>
                    <ul>
                        <li>L'inhalation de peinture en aérosol est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous êtes dépendant, cherchez de l'aide médicale.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés à la Peinture en Aérosol (Inhalation) :</strong></p>
                    <ul>
                        <li>Mort subite par arrêt cardiaque.</li>
                        <li>Dommages irréversibles au cerveau, au cœur, aux reins et au foie.</li>
                        <li>Asphyxie, convulsions, coma.</li>
                        <li>Effets imprévisibles : hallucinations, vertiges, nausées.</li>
                        <li>Évitez tout contact avec la peau et les yeux.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Désodorisant (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Désodorisant (Inhalation) :</strong></p>
                    <ul>
                        <li>L'inhalation de désodorisant est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous êtes dépendant, cherchez de l'aide médicale.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Désodorisant (Inhalation) :</strong></p>
                    <ul>
                        <li>Mort subite par arrêt cardiaque.</li>
                        <li>Dommages irréversibles au cerveau, au cœur, aux reins et au foie.</li>
                        <li>Asphyxie, convulsions, coma.</li>
                        <li>Effets imprévisibles : hallucinations, vertiges, nausées.</li>
                        <li>Évitez tout contact avec la peau et les yeux.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                },
                { name: "Nettoyant pour ordinateur (inhalation)", 
                  usageAdvice: `
                    <p><strong>Conseils de prise pour le Nettoyant pour Ordinateur (Inhalation) :</strong></p>
                    <ul>
                        <li>L'inhalation de nettoyants pour ordinateur est extrêmement dangereuse. La meilleure prévention est de ne pas en consommer.</li>
                        <li>Si vous êtes dépendant, cherchez de l'aide médicale.</li>
                    </ul>
                  `, 
                  riskAdvice: `
                    <p><strong>Risques liés au Nettoyant pour Ordinateur (Inhalation) :</strong></p>
                    <ul>
                        <li>Mort subite par arrêt cardiaque.</li>
                        <li>Dommages irréversibles au cerveau, au cœur, aux reins et au foie.</li>
                        <li>Asphyxie, convulsions, coma.</li>
                        <li>Effets imprévisibles : hallucinations, vertiges, nausées.</li>
                        <li>Évitez tout contact avec la peau et les yeux.</li>
                    </ul>
                  `, 
                  dangerousWithAlcohol: true
                }
            ]
        };


        let consumedItems = [];
        let synth; 
        let activeTab = 'alcool'; // Default active tab


        // BAC Constants
        const ETHANOL_DENSITY = 0.789; // g/ml
        const MALE_R_FACTOR = 0.68; // Widmark factor for males
        const FEMALE_R_FACTOR = 0.55; // Widmark factor for females
        const ELIMINATION_RATE = 0.15; // g/L per hour (average)
        const LEGAL_LIMIT_STANDARD = 0.5;
        const LEGAL_LIMIT_YOUNG_DRIVER = 0.2;


        // Purity Test Questions (30 questions)
        const purityQuestions = [
            // Alcool (5 questions)
            { id: 'p1', text: 'Avez-vous déjà bu de l\'alcool ?', category: 'alcool' },
            { id: 'p2', text: 'Avez-vous déjà été ivre ?', category: 'alcool' },
            { id: 'p3', text: 'Avez-vous déjà eu un black-out à cause de l\'alcool ?', category: 'alcool' },
            { id: 'p4', text: 'Avez-vous déjà bu de l\'alcool en étant mineur ?', category: 'alcool' },
            { id: 'p5', text: 'Avez-vous déjà conduit sous l\'influence de l\'alcool ?', category: 'alcool' },
            
            // Drogues (5 questions)
            { id: 'p6', text: 'Avez-vous déjà fumé du cannabis (ou équivalent) ?', category: 'drogues' },
            { id: 'p7', text: 'Avez-vous déjà essayé une drogue dure (cocaïne, héroïne, etc.) ?', category: 'drogues' },
            { id: 'p8', text: 'Avez-vous déjà vendu de la drogue ?', category: 'drogues' },
            { id: 'p9', text: 'Avez-vous déjà consommé des drogues à l\'école ou au travail ?', category: 'drogues' },
            { id: 'p10', text: 'Avez-vous déjà été arrêté pour possession ou consommation de drogue ?', category: 'drogues' },

            // Sexualité (10 questions)
            { id: 'p11', text: 'Avez-vous déjà embrassé quelqu\'un ?', category: 'sexualite' },
            { id: 'p12', text: 'Avez-vous déjà eu des relations sexuelles ?', category: 'sexualite' },
            { id: 'p13', text: 'Avez-vous déjà eu un rapport sexuel non protégé ?', category: 'sexualite' },
            { id: 'p14', text: 'Avez-vous déjà eu une aventure d\'un soir ?', category: 'sexualite' },
            { id: 'p15', text: 'Avez-vous déjà trompé quelqu\'un ?', category: 'sexualite' },
            { id: 'p16', text: 'Avez-vous déjà eu des relations sexuelles dans un lieu public ?', category: 'sexualite' },
            { id: 'p17', text: 'Avez-vous déjà eu des relations sexuelles avec plus d\'une personne en 24h ?', category: 'sexualite' },
            { id: 'p18', text: 'Avez-vous déjà eu des relations sexuelles avec une personne beaucoup plus âgée/jeune que vous (différence de plus de 10 ans) ?', category: 'sexualite' },
            { id: 'p19', text: 'Avez-vous déjà eu des relations sexuelles avec un(e) ami(e) proche ?', category: 'sexualite' },
            { id: 'p20', text: 'Avez-vous déjà eu des relations sexuelles avec quelqu\'un que vous venez de rencontrer ?', category: 'sexualite' },

            // Général / Rébellion (10 questions)
            { id: 'p21', text: 'Avez-vous déjà séché les cours ou le travail ?', category: 'general' },
            { id: 'p22', text: 'Avez-vous déjà volé quelque chose (même petit) ?', category: 'general' },
            { id: 'p23', text: 'Avez-vous déjà menti à vos parents ou à une figure d\'autorité ?', category: 'general' },
            { id: 'p24', text: 'Avez-vous déjà eu une altercation physique ou une bagarre ?', category: 'general' },
            { id: 'p25', text: 'Avez-vous déjà été arrêté par la police ?', category: 'general' },
            { id: 'p26', text: 'Avez-vous déjà fait un tatouage ou un piercing (sans accord parental si mineur) ?', category: 'general' },
            { id: 'p27', text: 'Avez-vous déjà fugué de chez vous ?', category: 'general' },
            { id: 'p28', text: 'Avez-vous déjà triché à un examen ou un test important ?', category: 'general' },
            { id: 'p29', text: 'Avez-vous déjà conduit sans permis ou sans assurance ?', category: 'general' },
            { id: 'p30', text: 'Avez-vous déjà détruit la propriété de quelqu\'un d\'autre intentionnellement ?', category: 'general' }
        ];


        // --- Sound Functions ---
        async function setupAudio() {
            if (!synth) {
                try {
                    await Tone.start(); 
                    synth = new Tone.Synth({
                        oscillator: { type: "sine" },
                        envelope: { attack: 0.01, decay: 0.1, sustain: 0.05, release: 0.2 }
                    }).toDestination();
                } catch (e) {
                    console.warn("Tone.js n'a pas pu démarrer. Les sons seront désactivés.", e);
                }
            }
        }
        function playFeedbackSound(note = "C4", duration = "8n") {
            if (synth && Tone.context.state === "running") {
                try { synth.triggerAttackRelease(note, duration); } 
                catch (e) { console.warn("Erreur son:", e); }
            }
        }


        // --- Tab Management ---
        function switchTab(tabName) {
            activeTab = tabName;
            // Update button active states
            tabAlcoolButton.classList.toggle('active', tabName === 'alcool');
            tabDrogueButton.classList.toggle('active', tabName === 'drogue');
            tabPureteButton.classList.toggle('active', tabName === 'purete');

            // Update pane active states
            tabAlcoolPane.classList.toggle('active', tabName === 'alcool');
            tabDroguePane.classList.toggle('active', tabName === 'drogue');
            tabPuretePane.classList.toggle('active', tabName === 'purete');
            
            // Show/hide BAC calculator and consumption summary based on tab
            if (tabName === 'alcool') { // Only show for 'alcool' tab
                bacCalculatorSection.classList.remove('hidden');
                consumptionSummarySection.classList.remove('hidden');
            } else { // 'drogue' or 'purete'
                bacCalculatorSection.classList.add('hidden');
                consumptionSummarySection.classList.add('hidden');
            }

            // Clear search and hide suggestions when switching tabs for Alcool/Drogue
            if (tabName !== 'purete') {
                searchAlcoolInput.value = '';
                alcoolSuggestionsDiv.classList.add('hidden');
                selectedAlcoolItem = null;
                volumeAlcoolInput.value = '1'; 
                
                searchDrogueInput.value = '';
                drogueSuggestionsDiv.classList.add('hidden');
                selectedDrogueItem = null;
                showDrugAdviceButton.disabled = true; 
            } else {
                // When switching to purity test, ensure intro is shown if not started
                if (!purityTestQuestionsContainer.classList.contains('hidden')) {
                    purityTestIntro.classList.add('hidden');
                    purityTestQuestionsContainer.classList.remove('hidden');
                } else {
                    purityTestIntro.classList.remove('hidden');
                    purityTestQuestionsContainer.classList.add('hidden');
                }
                purityResultsDiv.classList.add('hidden'); // Always hide results when switching to purity tab
            }
        }


        // --- Suggestion List Rendering ---
        function renderSuggestions(inputElement, suggestionsDiv, items, isAlcool = false) {
            suggestionsDiv.innerHTML = '';
            if (items.length === 0 || inputElement.value.trim() === '') {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            suggestionsDiv.classList.remove('hidden');

            items.forEach(item => {
                const suggestionItem = document.createElement('div');
                suggestionItem.classList.add('suggestion-item');
                if (isAlcool) {
                    suggestionItem.textContent = `${item.name} (${item.degree}%) - ${item.unitVolume}ml`;
                } else {
                    suggestionItem.textContent = item.name;
                }
                
                suggestionItem.addEventListener('mousedown', (e) => { // Use mousedown to prevent blur before click
                    e.preventDefault(); // Prevent input from losing focus
                    inputElement.value = item.name;
                    if (isAlcool) {
                        selectedAlcoolItem = item;
                        volumeAlcoolInput.value = item.unitVolume;
                    } else {
                        selectedDrogueItem = item;
                        showDrugAdviceButton.disabled = false;
                    }
                    suggestionsDiv.classList.add('hidden');
                });
                suggestionsDiv.appendChild(suggestionItem);
            });
        }


        // --- Filter and Render Functions ---
        function filterAlcoolOptions() {
            const searchTerm = searchAlcoolInput.value.toLowerCase();
            const filteredAlcools = substances.alcool.filter(item => 
                item.name.toLowerCase().includes(searchTerm)
            );
            renderSuggestions(searchAlcoolInput, alcoolSuggestionsDiv, filteredAlcools, true);

            // If search input is cleared, reset selected item and volume
            if (searchTerm === '') {
                selectedAlcoolItem = null;
                volumeAlcoolInput.value = '1';
            } else if (selectedAlcoolItem && selectedAlcoolItem.name.toLowerCase() !== searchTerm) {
                // If user types after selecting, clear selection
                selectedAlcoolItem = null;
                volumeAlcoolInput.value = '1';
            }
        }

        function filterDrogueOptions() {
            const searchTerm = searchDrogueInput.value.toLowerCase();
            const filteredDrogues = substances.drogue.filter(item => 
                item.name.toLowerCase().includes(searchTerm)
            );
            renderSuggestions(searchDrogueInput, drogueSuggestionsDiv, filteredDrogues);

            // If search input is cleared, reset selected item and disable advice button
            if (searchTerm === '') {
                selectedDrogueItem = null;
                showDrugAdviceButton.disabled = true;
            } else if (selectedDrogueItem && selectedDrogueItem.name.toLowerCase() !== searchTerm) {
                // If user types after selecting, clear selection
                selectedDrogueItem = null;
                showDrugAdviceButton.disabled = true;
            }
        }
        
        // --- Item Management ---
        function addItem(type) {
            let name, quantity, itemData;

            if (type === 'alcool') {
                if (!selectedAlcoolItem) {
                    showCustomMessage("Veuillez sélectionner un alcool dans la liste. 🧐", "warning");
                    return;
                }
                name = selectedAlcoolItem.name;
                quantity = parseInt(quantityAlcoolInput.value);
                if (isNaN(quantity) || quantity < 1) {
                    showCustomMessage("Veuillez entrer une quantité valide (minimum 1). 🔢", "warning");
                    return;
                }
                itemData = { 
                    type, 
                    name, 
                    quantity, 
                    id: Date.now(), 
                    degree: selectedAlcoolItem.degree, 
                    unitVolume: parseInt(volumeAlcoolInput.value), // Use current volume input value
                    timestamp: Date.now() // Add timestamp
                };
            } else if (type === 'drogue') {
                if (!selectedDrogueItem) {
                    showCustomMessage("Veuillez sélectionner une drogue dans la liste. 🧐", "warning");
                    return;
                }
                name = selectedDrogueItem.name;
                quantity = parseInt(quantityDrogueInput.value);
                if (isNaN(quantity) || quantity < 1) {
                    showCustomMessage("Veuillez entrer une quantité valide (minimum 1). 🔢", "warning");
                    return;
                }
                itemData = { 
                    type, 
                    name, 
                    quantity, 
                    id: Date.now(), 
                    usageAdvice: selectedDrogueItem.usageAdvice, // Use new property
                    riskAdvice: selectedDrogueItem.riskAdvice,   // Use new property
                    dangerousWithAlcohol: selectedDrogueItem.dangerousWithAlcohol,
                    timestamp: Date.now() // Add timestamp
                };

                // Check for alcohol interaction if this drug is dangerous with alcohol
                if (itemData.dangerousWithAlcohol) {
                    const hasAlcohol = consumedItems.some(ci => ci.type === 'alcool' && ci.quantity > 0);
                    if (hasAlcohol) {
                        showCustomMessage("🚨 Attention : Le mélange de cette drogue avec l'alcool est fortement déconseillé et peut être très dangereux pour votre santé. Soyez extrêmement vigilant ! 💀", "error");
                    }
                }
            }

            consumedItems.push(itemData);
            updateConsumptionList();
            playFeedbackSound("E4", "16n");

            // Reset inputs and selections after adding
            if (type === 'alcool') {
                searchAlcoolInput.value = '';
                selectedAlcoolItem = null;
                volumeAlcoolInput.value = '1';
                quantityAlcoolInput.value = '1';
                alcoolSuggestionsDiv.classList.add('hidden');
                updateBacCalculator(); 
            } else {
                searchDrogueInput.value = '';
                selectedDrogueItem = null;
                showDrugAdviceButton.disabled = true;
                quantityDrogueInput.value = '1';
                drogueSuggestionsDiv.classList.add('hidden');
            }
        }

        function updateItemQuantity(itemId, newQuantity) {
            const itemIndex = consumedItems.findIndex(item => item.id === itemId);
            if (itemIndex > -1) {
                const parsedQuantity = parseInt(newQuantity);
                if (!isNaN(parsedQuantity) && parsedQuantity >= 1) {
                    consumedItems[itemIndex].quantity = parsedQuantity;
                    updateConsumptionList();
                    updateBacCalculator(); 
                    playFeedbackSound("C4", "16n");
                } else {
                    const originalItem = consumedItems[itemIndex];
                    if (originalItem) {
                        const inputElement = consumptionListDiv.querySelector(`input[data-item-id="${itemId}"]`);
                        if (inputElement) {
                            inputElement.value = originalItem.quantity;
                        }
                    }
                    showCustomMessage("Veuillez entrer une quantité valide (minimum 1). 🔢", "warning");
                }
            }
        }


        function updateConsumptionList() {
            consumptionListDiv.innerHTML = ''; 
            let totalUnits = 0;

            if (consumedItems.length === 0) {
                consumptionListDiv.appendChild(emptyListMessage);
                emptyListMessage.style.display = 'block';
            } else {
                emptyListMessage.style.display = 'none';
                consumedItems.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('consumption-item');
                    
                    const itemDetails = document.createElement('div');
                    itemDetails.classList.add('flex', 'items-center', 'flex-grow', 'flex-wrap', 'mr-2'); 

                    const itemLabel = document.createElement('span');
                    itemLabel.textContent = item.name + " - ";
                    itemDetails.appendChild(itemLabel);

                    const itemTypeSpan = document.createElement('span');
                    itemTypeSpan.textContent = item.type.charAt(0).toUpperCase() + item.type.slice(1);
                    itemTypeSpan.classList.add(item.type === 'alcool' ? 'consumption-item-type-alcool' : 'consumption-item-type-drogue');
                    itemDetails.appendChild(itemTypeSpan);

                    const quantityInput = document.createElement('input');
                    quantityInput.type = 'number';
                    quantityInput.value = item.quantity;
                    quantityInput.min = '1';
                    quantityInput.classList.add('quantity-input-list');
                    quantityInput.dataset.itemId = item.id; 
                    quantityInput.addEventListener('input', (e) => updateItemQuantity(item.id, e.target.value));
                    itemDetails.appendChild(quantityInput);

                    if (item.type === 'alcool' && item.unitVolume) {
                        const volumeSpan = document.createElement('span');
                        volumeSpan.textContent = ` (${item.unitVolume}ml)`;
                        volumeSpan.classList.add('text-gray-400', 'text-sm', 'ml-1');
                        itemDetails.appendChild(volumeSpan);
                    }


                    itemDiv.appendChild(itemDetails);

                    const actionsContainer = document.createElement('div');
                    actionsContainer.classList.add('flex', 'items-center', 'ml-auto'); 

                    // Advice button for drugs in the list
                    if (item.type === 'drogue' && item.usageAdvice) { // Check for usageAdvice now
                        const adviceButton = document.createElement('button');
                        adviceButton.textContent = 'Conseils';
                        adviceButton.classList.add('text-blue-400', 'hover:text-blue-600', 'font-bold', 'ml-2', 'px-2', 'py-1', 'rounded', 'border', 'border-blue-400', 'hover:border-blue-600', 'text-xs'); 
                        adviceButton.title = "Voir les conseils de réduction des risques";
                        adviceButton.onclick = () => showDrugAdviceModal(item.name, item.usageAdvice, item.riskAdvice); // Pass both advice types
                        actionsContainer.appendChild(adviceButton);
                    }

                    const removeButton = document.createElement('button');
                    removeButton.textContent = '✕';
                    removeButton.classList.add('text-red-400', 'hover:text-red-600', 'font-bold', 'ml-2', 'px-2', 'py-1', 'rounded');
                    removeButton.title = "Supprimer cet élément";
                    removeButton.onclick = () => removeItem(item.id);
                    actionsContainer.appendChild(removeButton);
                    
                    itemDiv.appendChild(actionsContainer);
                    consumptionListDiv.appendChild(itemDiv);
                    totalUnits += item.quantity; 
                });
            }
            totalUnitsCount.textContent = totalUnits;
        }
        
        function removeItem(itemId) {
            consumedItems = consumedItems.filter(item => item.id !== itemId);
            updateConsumptionList();
            updateBacCalculator(); 
            playFeedbackSound("C3", "16n");
        }


        // Custom Modal for Confirm/Alert
        function showCustomConfirmModal(message, onConfirm) {
            const modalId = 'customConfirmModal';
            let modal = document.getElementById(modalId);

            if (!modal) {
                modal = document.createElement('div');
                modal.id = modalId;
                modal.classList.add('fixed', 'inset-0', 'bg-black', 'bg-opacity-75', 'flex', 'items-center', 'justify-center', 'z-50', 'p-4');
                modal.innerHTML = `
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center border border-gray-700">
                        <p class="text-gray-200 text-lg mb-6" id="customConfirmMessage"></p>
                        <div class="flex justify-around space-x-4">
                            <button id="customConfirmYes" class="custom-button button-red flex-1">Oui 👍</button>
                            <button id="customConfirmNo" class="custom-button button-green flex-1">Non 👎</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            document.getElementById('customConfirmMessage').textContent = message;
            modal.classList.remove('hidden');

            const confirmYes = document.getElementById('customConfirmYes');
            const confirmNo = document.getElementById('customConfirmNo');

            const cleanup = () => {
                confirmYes.onclick = null;
                confirmNo.onclick = null;
                modal.classList.add('hidden');
            };

            confirmYes.onclick = () => {
                onConfirm(true);
                cleanup();
            };
            confirmNo.onclick = () => {
                onConfirm(false);
                cleanup();
            };
        }

        function showCustomMessage(message, type = 'info') {
            const modalId = 'customMessageModal';
            let modal = document.getElementById(modalId);

            if (!modal) {
                modal = document.createElement('div');
                modal.id = modalId;
                modal.classList.add('fixed', 'inset-0', 'bg-black', 'bg-opacity-75', 'flex', 'items-center', 'justify-center', 'z-50', 'p-4');
                modal.innerHTML = `
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center border border-gray-700">
                        <p class="text-gray-200 text-lg mb-6" id="customMessageText"></p>
                        <button id="customMessageOk" class="custom-button button-green w-full">OK ✅</button>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            document.getElementById('customMessageText').textContent = message;
            const messageTextElement = document.getElementById('customMessageText');
            messageTextElement.className = 'text-lg mb-6'; // Reset classes

            if (type === 'warning') {
                messageTextElement.classList.add('text-yellow-400');
            } else if (type === 'error') {
                messageTextElement.classList.add('text-red-400');
            } else {
                messageTextElement.classList.add('text-gray-200');
            }

            modal.classList.remove('hidden');

            const messageOk = document.getElementById('customMessageOk');
            messageOk.onclick = () => {
                modal.classList.add('hidden');
            };
        }

        // Modified showDrugAdviceModal to handle tabs
        function showDrugAdviceModal(title, usageAdviceHtml, riskAdviceHtml) {
            drugAdviceTitle.textContent = title;
            modalTabUsagePane.innerHTML = usageAdviceHtml;
            modalTabRisksPane.innerHTML = riskAdviceHtml;
            drugAdviceModal.classList.remove('hidden');

            // Default to usage advice tab when opening
            switchModalTab('usage'); 
        }

        // New function to switch tabs within the modal
        function switchModalTab(tabName) {
            modalTabUsageButton.classList.toggle('active', tabName === 'usage');
            modalTabRisksButton.classList.toggle('active', tabName === 'risks');
            modalTabUsagePane.classList.toggle('active', tabName === 'usage');
            modalTabRisksPane.classList.toggle('active', tabName === 'risks');
        }

        closeDrugAdviceModalButton.addEventListener('click', () => {
            drugAdviceModal.classList.add('hidden');
        });

        // Event listeners for new modal tabs
        modalTabUsageButton.addEventListener('click', () => switchModalTab('usage'));
        modalTabRisksButton.addEventListener('click', () => switchModalTab('risks'));


        function resetList() {
            showCustomConfirmModal("Êtes-vous sûr de vouloir réinitialiser toutes les consommations ? 🔄", (confirmed) => {
                if (confirmed) {
                    consumedItems = [];
                    updateConsumptionList();
                    updateBacCalculator(); 
                    playFeedbackSound("A3", "8n");
                }
            });
        }


        // --- BAC Calculator Logic ---
        function updateBacCalculator() {
            const weight = parseFloat(weightInput.value);
            const gender = genderSelect.value; 
            const isYoungDriver = youngDriverCheckbox.checked;
            const currentLegalLimit = isYoungDriver ? LEGAL_LIMIT_YOUNG_DRIVER : LEGAL_LIMIT_STANDARD;

            let totalPureAlcoholGrams = 0;
            let firstAlcoholConsumptionTime = null;

            // Calculate total pure alcohol and find the timestamp of the first alcohol consumption
            consumedItems.forEach(item => {
                if (item.type === 'alcool' && item.degree !== undefined && item.unitVolume !== undefined) {
                    totalPureAlcoholGrams += (item.unitVolume * (item.degree / 100) * ETHANOL_DENSITY * item.quantity);
                    if (firstAlcoholConsumptionTime === null || item.timestamp < firstAlcoholConsumptionTime) {
                        firstAlcoholConsumptionTime = item.timestamp;
                    }
                }
            });

            if (isNaN(weight) || weight <= 0) {
                bacDisplay.textContent = "N/A";
                soberUpTimeDisplay.textContent = "N/A";
                drivingStatusDisplay.textContent = "Poids invalide ⚖️";
                drivingStatusDisplay.className = "text-xl font-semibold text-yellow-400";
                driveTimeDisplay.textContent = "--:--";
                return;
            }
            
            if (totalPureAlcoholGrams === 0) {
                bacDisplay.textContent = "0.00";
                drivingStatusDisplay.textContent = "Apte à conduire ✅";
                drivingStatusDisplay.className = "text-xl font-semibold text-green-400";
                soberUpTimeDisplay.textContent = "0h 00m";
                driveTimeDisplay.textContent = "Maintenant ⏰";
                return;
            }

            const rFactor = (gender === 'male') ? MALE_R_FACTOR : FEMALE_R_FACTOR;
            const peakBac = totalPureAlcoholGrams / (weight * rFactor); 

            let currentBac = peakBac;
            if (firstAlcoholConsumptionTime !== null) {
                const currentTime = Date.now();
                const elapsedMilliseconds = currentTime - firstAlcoholConsumptionTime;
                const elapsedHours = elapsedMilliseconds / (1000 * 60 * 60);
                
                const eliminatedAlcoholBac = ELIMINATION_RATE * elapsedHours;
                currentBac = Math.max(0, peakBac - eliminatedAlcoholBac); // Ensure BAC doesn't go below 0
            }

            bacDisplay.textContent = currentBac.toFixed(2);

            if (currentBac <= currentLegalLimit) {
                drivingStatusDisplay.textContent = "Apte à conduire ✅";
                drivingStatusDisplay.className = "text-xl font-semibold text-green-400";
                
                const timeToZeroHours = currentBac / ELIMINATION_RATE;
                const hoursToZero = Math.floor(timeToZeroHours);
                const minutesToZero = Math.round((timeToZeroHours - hoursToZero) * 60);
                soberUpTimeDisplay.textContent = `${hoursToZero}h ${minutesToZero}m (pour 0.00)`;
                
                driveTimeDisplay.textContent = "Maintenant ⏰";

            } else {
                drivingStatusDisplay.textContent = "INAPTE À CONDUIRE ⛔";
                drivingStatusDisplay.className = "text-xl font-semibold text-red-500";

                const bacToEliminateToLegal = currentBac - currentLegalLimit;
                let timeToReachLimitHours = 0;
                if (bacToEliminateToLegal > 0) {
                    timeToReachLimitHours = bacToEliminateToLegal / ELIMINATION_RATE;
                }

                const hoursSoberUp = Math.floor(timeToReachLimitHours);
                const minutesSoberUp = Math.round((timeToReachLimitHours - hoursSoberUp) * 60);
                soberUpTimeDisplay.textContent = `${hoursSoberUp}h ${minutesSoberUp}m`;

                const currentTime = new Date();
                const futureTime = new Date(currentTime.getTime() + timeToReachLimitHours * 60 * 60 * 1000);
                const driveHours = futureTime.getHours().toString().padStart(2, '0');
                const driveMinutes = futureTime.getMinutes().toString().padStart(2, '0');
                driveTimeDisplay.textContent = `${driveHours}:${driveMinutes} ⏳`;
            }
        }

        // --- Purity Test Functions ---
        function startPurityTest() {
            purityTestIntro.classList.add('hidden');
            purityTestQuestionsContainer.classList.remove('hidden');
            purityResultsDiv.classList.add('hidden');
            currentQuestionIndex = 0;
            purityAnswers = {}; // Reset answers
            displayCurrentPurityQuestion();
        }

        function displayCurrentPurityQuestion() {
            const question = purityQuestions[currentQuestionIndex];
            currentPurityQuestion.textContent = question.text;
            purityQuestionCounter.textContent = `Question ${currentQuestionIndex + 1} / ${purityQuestions.length}`;

            // Highlight Yes/No buttons based on stored answer
            const currentQuestionId = purityQuestions[currentQuestionIndex].id;
            purityAnswerYesButton.classList.remove('border-2', 'border-yellow-400');
            purityAnswerNoButton.classList.remove('border-2', 'border-yellow-400');

            if (purityAnswers[currentQuestionId] === true) {
                purityAnswerYesButton.classList.add('border-2', 'border-yellow-400');
            } else if (purityAnswers[currentQuestionId] === false) {
                purityAnswerNoButton.classList.add('border-2', 'border-yellow-400');
            }
        }

        function answerPurityQuestion(answer) {
            const currentQuestionId = purityQuestions[currentQuestionIndex].id;
            purityAnswers[currentQuestionId] = answer;
            playFeedbackSound("C5", "32n"); // Play a subtle sound on answer
            
            // Auto-advance logic
            if (currentQuestionIndex < purityQuestions.length - 1) {
                currentQuestionIndex++;
                setTimeout(displayCurrentPurityQuestion, 300); // Small delay for visual feedback
            } else {
                // Last question answered, show results
                setTimeout(calculateAndShowPurityResults, 500); // Small delay before showing results
            }
        }

        function calculateAndShowPurityResults() {
            // Check if all questions are answered (should be by now with auto-advance)
            const allAnswered = purityQuestions.every(q => purityAnswers.hasOwnProperty(q.id));
            if (!allAnswered) {
                showCustomMessage("Veuillez répondre à toutes les questions avant de voir les résultats. 🧐", "warning");
                return;
            }

            const scores = {
                alcool: { yes: 0, total: 0 },
                drogues: { yes: 0, total: 0 },
                sexualite: { yes: 0, total: 0 },
                general: { yes: 0, total: 0 },
                overall: { yes: 0, total: purityQuestions.length }
            };

            purityQuestions.forEach(q => {
                const category = q.category;
                scores[category].total++;
                if (purityAnswers[q.id] === true) { // If answered 'Yes'
                    scores[category].yes++;
                    scores.overall.yes++;
                }
            });

            const purityPercentages = {};
            for (const category in scores) {
                if (scores[category].total > 0) { // Avoid division by zero
                    const purity = (scores[category].total - scores[category].yes) / scores[category].total * 100;
                    purityPercentages[category] = purity.toFixed(0);
                } else {
                    purityPercentages[category] = 100; // If no questions in category, assume 100% pure
                }
            }
            const overallPurity = (scores.overall.total - scores.overall.yes) / scores.overall.total * 100;
            purityPercentages.overall = overallPurity.toFixed(0);

            displayPurityResults(purityPercentages);
            displayPurityComment(overallPurity); // Display the funny comment
            drawPurityChart(purityPercentages);
            purityTestQuestionsContainer.classList.add('hidden');
            purityResultsDiv.classList.remove('hidden');
            playFeedbackSound("G4", "8n");
        }

        function displayPurityResults(percentages) {
            purityScoresSummaryDiv.innerHTML = `
                <div class="purity-results-item"><span>Pureté Alcool :</span> <span>${percentages.alcool}%</span></div>
                <div class="purity-results-item"><span>Pureté Drogues :</span> <span>${percentages.drogues}%</span></div>
                <div class="purity-results-item"><span>Pureté Sexualité :</span> <span>${percentages.sexualite}%</span></div>
                <div class="purity-results-item"><span>Pureté Général :</span> <span>${percentages.general}%</span></div>
                <div class="purity-results-item total mt-4"><span>Score de Pureté Global :</span> <span>${percentages.overall}%</span></div>
            `;
        }

        function displayPurityComment(overallPurity) {
            let comment = "";
            if (overallPurity >= 90) {
                comment = "Félicitations ! Vous êtes si pur(e), les anges vous applaudissent. Ou peut-être que vous n'avez pas encore vécu ? 🤔";
            } else if (overallPurity >= 70) {
                comment = "Pas mal du tout ! Votre pureté est comme un diamant... avec quelques petites fissures très charmantes. 😉";
            } else if (overallPurity >= 50) {
                comment = "Mi-ange, mi-démon ! Vous avez un équilibre parfait entre la sagesse et les petites folies. On adore ! 😈😇";
            } else if (overallPurity >= 30) {
                comment = "Oups ! On dirait que votre côté obscur a pris le dessus. Mais c'est ça, la vie, non ? 😜";
            } else {
                comment = "Wow ! Votre pureté est un mythe, une légende urbaine. Vous avez vécu 100 vies en une ! On veut les détails ! 🤯";
            }
            purityComment.textContent = comment;
        }

        function drawPurityChart(percentages) {
            if (purityChartInstance) {
                purityChartInstance.destroy(); // Destroy previous chart instance
            }

            const ctx = purityChartCanvas.getContext('2d');
            purityChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Alcool', 'Drogues', 'Sexualité', 'Général'],
                    datasets: [{
                        label: 'Votre Score de Pureté (%)',
                        data: [
                            percentages.alcool,
                            percentages.drogues,
                            percentages.sexualite,
                            percentages.general
                        ],
                        backgroundColor: 'rgba(147, 51, 234, 0.4)', // Purple with transparency
                        borderColor: '#a78bfa', // Lighter purple
                        borderWidth: 2,
                        pointBackgroundColor: '#a78bfa',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#a78bfa'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                color: '#4a5568' // Darker gray for angle lines
                            },
                            grid: {
                                color: '#4a5568' // Darker gray for grid lines
                            },
                            pointLabels: {
                                color: '#e2e8f0', // Light gray for labels
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                beginAtZero: true,
                                max: 100,
                                stepSize: 20,
                                color: '#a0aec0', // Lighter gray for tick labels
                                backdropColor: 'transparent' // No background for ticks
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false // Hide legend
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw + '%';
                                }
                            }
                        }
                    }
                }
            });
        }


        // --- Event Listeners ---
        startButton.addEventListener('click', () => {
            welcomeScreen.classList.add('hidden');
            mainAppScreen.classList.remove('hidden');
            setupAudio();
            switchTab('alcool'); 
            updateBacCalculator(); 
            // Set up a timer to periodically update the BAC calculation
            setInterval(updateBacCalculator, 60 * 1000); // Update every minute
        });

        tabAlcoolButton.addEventListener('click', () => switchTab('alcool'));
        tabDrogueButton.addEventListener('click', () => switchTab('drogue'));
        tabPureteButton.addEventListener('click', () => switchTab('purete')); 

        addAlcoolButton.addEventListener('click', () => {
            addItem('alcool'); 
        });
        addDrogueButton.addEventListener('click', () => {
            addItem('drogue'); 
        });
        
        resetButton.addEventListener('click', resetList);

        weightInput.addEventListener('input', updateBacCalculator);
        genderSelect.addEventListener('change', updateBacCalculator); 
        youngDriverCheckbox.addEventListener('change', updateBacCalculator);

        // Search bar event listeners
        searchAlcoolInput.addEventListener('input', filterAlcoolOptions);
        searchAlcoolInput.addEventListener('focus', filterAlcoolOptions); 
        searchAlcoolInput.addEventListener('blur', () => {
            setTimeout(() => alcoolSuggestionsDiv.classList.add('hidden'), 100);
        });

        searchDrogueInput.addEventListener('input', filterDrogueOptions);
        searchDrogueInput.addEventListener('focus', filterDrogueOptions); 
        searchDrogueInput.addEventListener('blur', () => {
            setTimeout(() => drogueSuggestionsDiv.classList.add('hidden'), 100);
        });

        // Event listener for the new "Conseils" button next to drug search
        showDrugAdviceButton.addEventListener('click', () => {
            if (selectedDrogueItem && selectedDrogueItem.usageAdvice && selectedDrogueItem.riskAdvice) {
                showDrugAdviceModal(selectedDrogueItem.name, selectedDrogueItem.usageAdvice, selectedDrogueItem.riskAdvice);
            } else {
                showCustomMessage("Veuillez sélectionner une drogue pour voir les conseils. 🧐", "warning");
            }
        });

        // Purity Test event listeners
        startPurityTestButton.addEventListener('click', startPurityTest);
        purityAnswerYesButton.addEventListener('click', () => answerPurityQuestion(true));
        purityAnswerNoButton.addEventListener('click', () => answerPurityQuestion(false));
        restartPurityTestButton.addEventListener('click', startPurityTest);


        // --- Initialisation ---
        window.onload = () => {
            welcomeScreen.classList.remove('hidden');
            mainAppScreen.classList.add('hidden');
            
            filterAlcoolOptions();
            filterDrogueOptions();
            
            updateConsumptionList(); 
            updateBacCalculator(); 
        };
    </script>
</body>
</html>
